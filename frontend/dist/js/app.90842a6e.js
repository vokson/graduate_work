(function(){var e={4166:function(e,t,s){"use strict";var r=s(9963),a=s(6252);function render(e,t,s,r,n,i){const o=(0,a.up)("base-page");return(0,a.wg)(),(0,a.j4)(o)}const n={class:"container"};function BasePagevue_type_template_id_a72634be_render(e,t,s,i,o,l){const _=(0,a.up)("navigation-component"),d=(0,a.up)("router-view");return(0,a.wg)(),(0,a.iD)("div",n,[(0,a.Wm)(_,{links:i.navigation_links},null,8,["links"]),(0,a.Wm)(d,null,{default:(0,a.w5)((({Component:e,route:t})=>[(0,a.Wm)(r.uT,{name:t.meta.transitionName},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.j4)((0,a.LL)(e),{key:t.path}))])),_:2},1032,["name"])])),_:1})])}var i=s(3577);const o={class:"nav"},l=(0,a._)("div",{class:"nav__empty"},null,-1);function NavigationComponentvue_type_template_id_4379e5f5_render(e,t,s,r,n,_){const d=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)("div",o,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.links,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.route_name,class:"nav__links"},[(0,a.Wm)(d,{class:"nav__item",to:{name:e.route_name}},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.title),1)])),_:2},1032,["to"])])))),128)),l])}var _=s(5222),d=(s(7658),s(2262));class NotImplementedError extends Error{}class AbstractBaseRepository{_deep_copy(e){return JSON.parse(JSON.stringify(e))}_create_name(e){const t=Array.isArray(e)?e.join():e;return t}_set(){throw new NotImplementedError('"set" method has not been implemented')}_get(){throw new NotImplementedError('"get" method has not been implemented')}_delete(){throw new NotImplementedError('"delete" method has not been implemented')}_add_key(){throw new NotImplementedError('"add_key" method has not been implemented')}_remove_key(){throw new NotImplementedError('"remove_key" method has not been implemented')}_keys(){throw new NotImplementedError('"keys" method has not been implemented')}_values(){throw new NotImplementedError('"values" method has not been implemented')}_pure_keys(){throw new NotImplementedError('"pure keys" method has not been implemented')}_keys_box(){throw new NotImplementedError('"keys box" method has not been implemented')}_values_box(){throw new NotImplementedError('"values box" method has not been implemented')}_pure_keys_box(){throw new NotImplementedError('"pure keys box" method has not been implemented')}_set_box(){throw new NotImplementedError('"set_box" method has not been implemented')}_get_box(){throw new NotImplementedError('"get_box" method has not been implemented')}_delete_box(){throw new NotImplementedError('"delete_box" method has not been implemented')}_add_box_key(){throw new NotImplementedError('"add_box_key" method has not been implemented')}_remove_box_key(){throw new NotImplementedError('"remove_box_key" method has not been implemented')}}class VueBaseRepository extends AbstractBaseRepository{constructor(e){super(),this._properties=(0,a.f3)(e)}_reset(){Object.keys(this._properties).forEach((e=>{delete this._properties[e]}))}_set(e,t,s=!0){const r=e.toString();Object.prototype.hasOwnProperty.call(this._properties,r)?this._properties[r].value=t:this._properties[r]=(0,d.iH)(t),s&&this._add_key(r)}_get(e,t=null){return Object.prototype.hasOwnProperty.call(this._properties,e)||this._set(e,this._deep_copy(t),!1),this._properties[e]}_delete(e){const t=e.toString();this._set(t,null),this._remove_key(t)}_add_key(e){Object.prototype.hasOwnProperty.call(this._properties,"__KEYS__")||(this._properties["__KEYS__"]=(0,d.iH)([]));const t=this._get("__KEYS__");-1===t.value.indexOf(e)&&t.value.push(e)}_remove_key(e){Object.prototype.hasOwnProperty.call(this._properties,"__KEYS__")&&(this._properties["__KEYS__"].value=this._properties["__KEYS__"].value.filter((t=>t!==e)))}_keys(){return this._get("__KEYS__",[])}_pure_keys(){const e=this._keys();return(0,d.dq)(e)?e.value:e}_values(){return this._keys().value.map((e=>this._get(e)))}_keys_box(e){const t=this._create_name(["BOX",e,"__KEYS__"]);return this._get(t,[])}_pure_keys_box(e){const t=this._keys_box(e);return(0,d.dq)(t)?t.value:t}_values_box(e){return this._keys_box(e).value.map((t=>this._get_box(e,t)))}_set_box(e,t,s){const r=this._create_name(["BOX",e,t]);this._set(r,s,!1),this._add_box_key(e,t.toString())}_get_box(e,t,s=null){const r=this._create_name(["BOX",e,t]);return this._get(r,s)}_delete_box(e,t){const s=this._create_name(["BOX",e,t]);this._delete(s),this._remove_box_key(e,t.toString())}_add_box_key(e,t){const s=this._create_name(["BOX",e,"__KEYS__"]);Object.prototype.hasOwnProperty.call(this._properties,s)||(this._properties[s]=(0,d.iH)([]));const r=this._get(s);-1===r.value.indexOf(t)&&r.value.push(t)}_remove_box_key(e,t){const s=this._create_name(["BOX",e,"__KEYS__"]);Object.prototype.hasOwnProperty.call(this._properties,s)&&(this._properties[s].value=this._properties[s].value.filter((e=>e!==t)))}}const c={reset(){this._reset()},reset_keeping_refs(){this.keys().value.forEach((e=>this.delete(e)))},get(e){return this._get(e)},set(e,t){return this._set(e,t)},delete(e){return this._delete(e)},keys(){return this._keys()},pure_keys(){return this._pure_keys()},values(){return this._values()}};class VueFlatRepository extends VueBaseRepository{}Object.assign(VueBaseRepository.prototype,c);const u={set_current(e){this._set_box("__CURRENT__","__CURRENT__",e)},get_current(){return this._get_box("__CURRENT__","__CURRENT__")},is_current_settled(){return null!==this._get_box("__CURRENT__","__CURRENT__").value}},p={is_authenticated(){return this.is_current_settled()}};class VueUserRepository extends VueFlatRepository{}Object.assign(VueUserRepository.prototype,u,p);s(2801);function parseJwt(e){var t=e.split(".")[1],s=t.replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(window.atob(s).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(r)}const get_exp_time_from_token=e=>{const t=parseJwt(e);return t["exp"]};function getCookie(e){let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}function deleteCookie(e){setCookie(e,"",{"max-age":-1})}function setCookie(e,t,s={}){s={path:"/",...s},s.expires instanceof Date&&(s.expires=s.expires.toUTCString());let r=encodeURIComponent(e)+"="+encodeURIComponent(t);for(let a in s){r+="; "+a;let e=s[a];!0!==e&&(r+="="+e)}document.cookie=r}const m={get_access_token(){return getCookie("access_token")},get_refresh_token(){return getCookie("refresh_token")},_set_token(e,t){const s=get_exp_time_from_token(t),r=new Date(1e3*s);setCookie(e,t,{sameSite:"strict",expires:r})},set_access_token(e){this._set_token("access_token",e)},set_refresh_token(e){this._set_token("refresh_token",e)}},g={reset(){deleteCookie("access_token"),deleteCookie("refresh_token")}};class VueTokenRepository extends VueBaseRepository{}Object.assign(VueTokenRepository.prototype,m,g);const h={reset(){this.keys().value.forEach((e=>this.delete(e)))},set_size(e,t){const s=this.get(e).value;s&&s.set_size(t)},set_total_size(e,t){const s=this.get(e).value;s&&s.set_total_size(t)},set_size_complete(e){const t=this.get(e).value;t&&t.set_size_complete()},get_file(e){return this.get(e).value},get_name(e){const t=this.get(e).value;return t.name},set_servers(e,t){const s=this.get(e).value;s&&(s.servers=t)}};class VueFileFlatRepository extends VueFlatRepository{}Object.assign(VueFileFlatRepository.prototype,h);var f=s(9714),v=s.n(f),w=s(1581),y=s.n(w),b=s(3351),k=s.n(b);class dataclass_NotImplementedError extends Error{}class DataClass{constructor(e){this._data=void 0,void 0!==e&&this._validate_using_schema(e,this.schema)}get data(){if(void 0===this._data)throw new dataclass_NotImplementedError("DataClass.data has not been assigned");return this._data}get schema(){throw new dataclass_NotImplementedError("Json schema is not defined")}_validate_using_schema(e,t){this.ajv=new(y())({allErrors:!0,allowUnionTypes:!0}),k()(this.ajv);const s=this.ajv.compile(t);if(s(e),null!==s.errors)throw s.errors.forEach((e=>console.log(e))),new dataclass_NotImplementedError("Object "+e.constructor.name+" does not correspond to json schema");this._data=e}}const F={type:"object",properties:{access_token:{type:"string"},refresh_token:{type:"string"}},required:["access_token","refresh_token"],additionalProperties:!1},x={type:"object",properties:{username:{type:"string"},email:{type:"string"},first_name:{type:"string"},last_name:{type:"string"},is_superuser:{type:"boolean"},permissions:{type:"array",items:{type:"string"}}},required:["username","email","first_name","last_name","is_superuser","permissions"],additionalProperties:!1},R={type:"object",properties:{id:{type:"string"},name:{type:"string"},host:{type:"string"},port:{type:"integer"},location:{type:"string"},zone:{type:"string"},latitude:{type:"number"},longitude:{type:"number"},is_on:{type:"boolean"},is_active:{type:"boolean"},created:{type:"string"},updated:{type:"string"}},required:["id","name","host","port","location","zone","latitude","longitude","is_on","is_active","created","updated"],additionalProperties:!1},q={type:"array",items:R},S={type:"object",properties:{id:{type:"string"},name:{type:"string"},size:{type:"number"},created:{type:"string"},updated:{type:"string"}},required:["id","name","size","created","updated"],additionalProperties:!1},D={type:"array",items:S},E={type:"object",properties:{file:S,link:{type:"string"}},required:["file","link"],additionalProperties:!1},C={type:"object",properties:{id:{type:"string"},event:{type:"string"},data:{type:"object"},created:{type:"string"}},required:["id","event","data","created"],additionalProperties:!1},z={type:"array",items:C},N={type:"object",properties:{id:{type:"string"},file:S,is_secured:{type:"boolean"},created:{type:"string"},expire_at:{type:["null","string"]}},required:["id","file","is_secured","expire_at","created"],additionalProperties:!1},I={type:"array",items:N};class api_NotImplementedError extends Error{}class Request extends DataClass{get schema(){return{type:"object",properties:{},additionalProperties:!1}}}class Response extends DataClass{}class NegativeResponse extends Response{get schema(){return{type:"object",properties:{code:{type:"string"}},additionalProperties:!1}}}class EmptyPositiveResponse extends Response{get schema(){return{type:"object",properties:{},additionalProperties:!1}}}class PositiveFileResponse extends Response{get schema(){return{type:"object",properties:{file:{type:"object"}},additionalProperties:!1}}}class LoginCredentialsRequest extends Request{get schema(){return{type:"object",properties:{username:{type:"string"},password:{type:"string"}},additionalProperties:!1}}}class LoginCredentialsResponse extends Response{get schema(){return F}}class LogoutRequest extends Request{}class LogoutResponse extends EmptyPositiveResponse{}class MyCredentialsRequest extends Request{}class MyCredentialsResponse extends Response{get schema(){return x}}class RefreshTokensRequest extends Request{}class RefreshTokensResponse extends Response{get schema(){return F}}class GetFilesRequest extends Request{}class GetFilesResponse extends Response{get schema(){return D}}class GetFileServersRequest extends Request{get schema(){return{type:"object",properties:{id:{type:"string"}},additionalProperties:!1}}}class GetFileServersResponse extends Response{get schema(){return q}}class DeleteFileRequest extends Request{get schema(){return{type:"object",properties:{id:{type:"string"}},additionalProperties:!1}}}class DeleteFileResponse extends EmptyPositiveResponse{}class RenameFileRequest extends Request{get schema(){return{type:"object",properties:{id:{type:"string"},name:{type:"string"}},additionalProperties:!1}}}class RenameFileResponse extends Response{get schema(){return S}}class GetCdnServersRequest extends Request{}class GetCdnServersResponse extends Response{get schema(){return q}}class AddCdnServerRequest extends Request{get schema(){return{type:"object",properties:{name:{type:"string"},host:{type:"string"},port:{type:"integer"},location:{type:"string"},zone:{type:"string"},latitude:{type:"number"},longitude:{type:"number"},is_on:{type:"boolean"},is_active:{type:"boolean"}},additionalProperties:!1}}}class AddCdnServerResponse extends Response{get schema(){return R}}class UpdateCdnServerRequest extends Request{get schema(){return{type:"object",properties:{id:{type:"string"},name:{type:"string"},host:{type:"string"},port:{type:"integer"},location:{type:"string"},zone:{type:"string"},latitude:{type:"number"},longitude:{type:"number"},is_on:{type:"boolean"},is_active:{type:"boolean"}},additionalProperties:!1}}}class UpdateCdnServerResponse extends Response{get schema(){return R}}class DeleteCdnServerRequest extends Request{get schema(){return{type:"object",properties:{id:{type:"string"}},additionalProperties:!1}}}class DeleteCdnServerResponse extends EmptyPositiveResponse{}class GetUploadLinkRequest extends Request{get schema(){return{type:"object",properties:{name:{type:"string"},size:{type:"integer"}},additionalProperties:!1}}}class GetUploadLinkResponse extends Response{get schema(){return E}}class GetDownloadLinkRequest extends Request{get schema(){return{type:"object",properties:{id:{type:"string"}},additionalProperties:!1}}}class GetDownloadLinkResponse extends Response{get schema(){return E}}class GetUserActionsRequest extends Request{get schema(){return{type:"object",properties:{page_num:{type:"integer"},page_size:{type:"integer"}},additionalProperties:!1}}}class GetUserActionsResponse extends Response{get schema(){return{type:"object",properties:{count:{type:"integer"},data:z},additionalProperties:!1}}}class UploadFileRequest extends Request{get schema(){return{type:"object",properties:{link:{type:"string"},original_file:{type:"object"}},additionalProperties:!0}}}class UploadFileResponse extends EmptyPositiveResponse{}class DownloadFileRequest extends Request{get schema(){return{type:"object",properties:{link:{type:"string"}},additionalProperties:!0}}}class DownloadFileResponse extends PositiveFileResponse{}class AddFileShareLinkRequest extends Request{get schema(){return{type:"object",properties:{id:{type:"string"},lifetime:{type:["null","integer"]},password:{type:["null","string"]}},additionalProperties:!1}}}class AddFileShareLinkResponse extends Response{get schema(){return N}}class GetFileShareLinksRequest extends Request{get schema(){return{type:"object",properties:{file_id:{type:"string"}},additionalProperties:!1}}}class GetFileShareLinksResponse extends Response{get schema(){return I}}class GetFileShareLinkRequest extends Request{get schema(){return{type:"object",properties:{file_id:{type:"string"},link_id:{type:"string"}},additionalProperties:!1}}}class GetFileShareLinkResponse extends Response{get schema(){return N}}class DeleteFileShareLinkRequest extends Request{get schema(){return{type:"object",properties:{file_id:{type:"string"},link_id:{type:"string"}},additionalProperties:!1}}}class DeleteFileShareLinkResponse extends EmptyPositiveResponse{}class GetDownloadLinkByFileShareLinkRequest extends Request{get schema(){return{type:"object",properties:{file_id:{type:"string"},link_id:{type:"string"},password:{type:["null","string"]}},additionalProperties:!1}}}class GetDownloadLinkByFileShareLinkResponse extends Response{get schema(){return E}}class AbstractApi{constructor(){(0,_.Z)(this,"call",(e=>{if(!Object.prototype.hasOwnProperty.call(this.REQUEST_HANDLERS,e.constructor.name))throw new api_NotImplementedError("API request does not have handler for "+e.constructor.name);const t=this.REQUEST_HANDLERS[e.constructor.name];return t(e)})),(0,_.Z)(this,"login_with_credentials",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"my_credentials",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"refresh_tokens",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"logout",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"get_cdn_servers",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"add_cdn_server",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"update_cdn_server",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"delete_cdn_server",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"get_user_actions",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"get_files",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"get_file_servers",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"delete_file",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"rename_file",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"get_upload_link",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"upload_file",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"get_download_link",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"download_file",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"add_file_share_link",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"get_file_share_links",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"delete_file_share_link",(()=>{throw new api_NotImplementedError})),(0,_.Z)(this,"get_download_link_by_file_share_link",(()=>{throw new api_NotImplementedError})),this._auth_token=null}get_auth_token(){return this._auth_token}set_auth_token(e){this._auth_token=e}}class HttpApiError extends Error{}class HttpApi extends AbstractApi{constructor(e){super(),(0,_.Z)(this,"login_with_credentials",(async e=>await this.perform_request(LoginCredentialsResponse,"/users/api/v1/auth/login/",{method:"post",data:JSON.stringify({username:e.data.username,password:e.data.password})}))),(0,_.Z)(this,"logout",(async()=>await this.perform_request(LogoutResponse,"/users/api/v1/auth/logout/",{method:"post"}))),(0,_.Z)(this,"my_credentials",(async()=>await this.perform_request(MyCredentialsResponse,"/users/api/v1/users/me/"))),(0,_.Z)(this,"refresh_tokens",(async()=>await this.perform_request(RefreshTokensResponse,"/users/api/v1/auth/token/refresh/",{method:"post"}))),(0,_.Z)(this,"get_cdn_servers",(async()=>await this.perform_request(GetCdnServersResponse,"/storage/api/v1/servers/"))),(0,_.Z)(this,"add_cdn_server",(async e=>await this.perform_request(AddCdnServerResponse,"/storage/api/v1/servers/",{method:"post",data:JSON.stringify({name:e.data.name,host:e.data.host,port:e.data.port,location:e.data.location,zone:e.data.zone,latitude:e.data.latitude,longitude:e.data.longitude,is_on:e.data.is_on,is_active:e.data.is_active})}))),(0,_.Z)(this,"update_cdn_server",(async e=>await this.perform_request(UpdateCdnServerResponse,`/storage/api/v1/servers/${e.data.id}/`,{method:"put",data:JSON.stringify({name:e.data.name,host:e.data.host,port:e.data.port,location:e.data.location,zone:e.data.zone,latitude:e.data.latitude,longitude:e.data.longitude,is_on:e.data.is_on,is_active:e.data.is_active})}))),(0,_.Z)(this,"delete_cdn_server",(async e=>await this.perform_request(DeleteCdnServerResponse,`/storage/api/v1/servers/${e.data.id}/`,{method:"delete"}))),(0,_.Z)(this,"get_user_actions",(async e=>await this.perform_request(GetUserActionsResponse,"/storage/api/v1/actions/",{method:"get",parameters:{page_num:e.data.page_num,page_size:e.data.page_size}}))),(0,_.Z)(this,"get_files",(async()=>await this.perform_request(GetFilesResponse,"/storage/api/v1/files/"))),(0,_.Z)(this,"get_file_servers",(async e=>await this.perform_request(GetFileServersResponse,`/storage/api/v1/files/${e.data.id}/servers/`))),(0,_.Z)(this,"delete_file",(async e=>await this.perform_request(DeleteFileResponse,`/storage/api/v1/files/${e.data.id}/`,{method:"delete"}))),(0,_.Z)(this,"rename_file",(async e=>await this.perform_request(RenameFileResponse,`/storage/api/v1/files/${e.data.id}/`,{method:"put",data:JSON.stringify({name:e.data.name})}))),(0,_.Z)(this,"get_upload_link",(async e=>await this.perform_request(GetUploadLinkResponse,"/storage/api/v1/files/upload/",{method:"post",data:JSON.stringify({name:e.data.name,size:e.data.size})}))),(0,_.Z)(this,"get_download_link",(async e=>await this.perform_request(GetDownloadLinkResponse,`/storage/api/v1/files/${e.data.id}/`))),(0,_.Z)(this,"upload_file",(async e=>await this.perform_request(UploadFileResponse,e.data.link,{method:"put",content_type:null,data:e.data.original_file,set_upload_size_method:e.data.on_progress}))),(0,_.Z)(this,"download_file",(async e=>await this.perform_request(DownloadFileResponse,e.data.link,{response_type:"blob",set_download_size_method:e.data.set_size_method}))),(0,_.Z)(this,"add_file_share_link",(async e=>await this.perform_request(AddFileShareLinkResponse,`/storage/api/v1/files/${e.data.id}/links/`,{method:"post",data:JSON.stringify({lifetime:e.data.lifetime,password:e.data.password})}))),(0,_.Z)(this,"get_file_share_links",(async e=>await this.perform_request(GetFileShareLinksResponse,`/storage/api/v1/files/${e.data.file_id}/links/`))),(0,_.Z)(this,"get_file_share_link",(async e=>await this.perform_request(GetFileShareLinkResponse,`/storage/api/v1/files/${e.data.file_id}/links/${e.data.link_id}/`))),(0,_.Z)(this,"delete_file_share_link",(async e=>await this.perform_request(DeleteFileShareLinkResponse,`/storage/api/v1/files/${e.data.file_id}/links/${e.data.link_id}/`,{method:"delete"}))),(0,_.Z)(this,"get_download_link_by_file_share_link",(async e=>await this.perform_request(GetDownloadLinkByFileShareLinkResponse,`/storage/api/v1/files/${e.data.file_id}/links/${e.data.link_id}/`,{method:"post",data:JSON.stringify({password:e.data.password})}))),this.api_url=e,this.REQUEST_HANDLERS={LoginCredentialsRequest:this.login_with_credentials,LogoutRequest:this.logout,MyCredentialsRequest:this.my_credentials,RefreshTokensRequest:this.refresh_tokens,GetUserActionsRequest:this.get_user_actions,GetCdnServersRequest:this.get_cdn_servers,AddCdnServerRequest:this.add_cdn_server,UpdateCdnServerRequest:this.update_cdn_server,DeleteCdnServerRequest:this.delete_cdn_server,GetFilesRequest:this.get_files,GetFileServersRequest:this.get_file_servers,DeleteFileRequest:this.delete_file,RenameFileRequest:this.rename_file,GetUploadLinkRequest:this.get_upload_link,UploadFileRequest:this.upload_file,GetDownloadLinkRequest:this.get_download_link,DownloadFileRequest:this.download_file,AddFileShareLinkRequest:this.add_file_share_link,GetFileShareLinksRequest:this.get_file_share_links,GetFileShareLinkRequest:this.get_file_share_link,DeleteFileShareLinkRequest:this.delete_file_share_link,GetDownloadLinkByFileShareLinkRequest:this.get_download_link_by_file_share_link}}async perform_request(e,t,{method:s="get",data:r=null,parameters:a={},content_type:n="application/json",response_type:i="text",set_upload_size_method:o=null,set_download_size_method:l=null,headers:_={}}={}){try{const d=await this.http_call(t,s,n,r,a,i,o,l,_);return new e(d)}catch(d){if(console.log(d.message),d instanceof HttpApiError)return new NegativeResponse({code:d.message});throw d}}async http_call(e,t,s,r,a,n,i,o,l){const _=e.startsWith("http");let d=null;_?d=new URL(`${e}`):(d=new URL(`${this.api_url}${e}`),d.search=new URLSearchParams(a).toString());let c=null;if(c=await new Promise(((e,a)=>{let c=new XMLHttpRequest;c.open(t,d),c.responseType=n,null!==s&&c.setRequestHeader("Content-Type",s),0!==Object.keys(l).length&&Object.keys(l).forEach((e=>{c.setRequestHeader(e,l[e])})),this._auth_token&&null!==this._auth_token&&!_&&c.setRequestHeader("Authorization","Bearer "+this._auth_token),null!==o&&(c.onprogress=e=>o(e.loaded)),null!==i&&(c.upload.onprogress=e=>i(e.loaded)),c.onerror=function(){console.log("Server unavailable"),a(new HttpApiError("Api.Server.Unavailable"))},c.onload=function(){const t=c.getResponseHeader("Content-Type"),s=Number.parseInt(c.getResponseHeader("Content-Length")),r="application/octet-stream"===t?v().decodeWords(c.getResponseHeader("Content-Disposition")):null;e({status_code:c.status,content_type:t,content_length:s,content_disposition:r,data:c.response})},null===r?c.send():c.send(r)})),_&&c.content_length>0)return{file:c.data};let u={};try{u=c.data instanceof Blob&&"application/json"===c.data.type?JSON.parse(await c.data.text()):JSON.parse(c.data)}catch(p){if(!_&&204!=c.status_code)throw new HttpApiError("Api.Error.NotJson")}if(c.status_code<200||c.status_code>=300)throw new HttpApiError(u.error);return u}}class api_provider_NotImplementedError extends Error{}class AbstractApiProvider{constructor(){(0,_.Z)(this,"get",(()=>{throw new api_provider_NotImplementedError}))}}class HttpApiProvider extends AbstractApiProvider{constructor(...e){super(...e),(0,_.Z)(this,"get",(()=>new HttpApi(window.location.origin)))}}var L=s(2854),A=s.n(L);class notificator_NotImplementedError extends Error{}class AbstractNotificator{constructor(){(0,_.Z)(this,"success",(()=>{throw new notificator_NotImplementedError})),(0,_.Z)(this,"info",(()=>{throw new notificator_NotImplementedError})),(0,_.Z)(this,"warning",(()=>{throw new notificator_NotImplementedError})),(0,_.Z)(this,"error",(()=>{throw new notificator_NotImplementedError}))}}class NotyNotificator extends AbstractNotificator{constructor(){super(),(0,_.Z)(this,"do",((e,t)=>{new(A())(Object.assign(this.default,{type:e,text:t})).show()})),(0,_.Z)(this,"success",(e=>{this.do("success",e)})),(0,_.Z)(this,"info",(e=>{this.do("info",e)})),(0,_.Z)(this,"warning",(e=>{this.do("warning",e)})),(0,_.Z)(this,"error",(e=>{this.do("error",e)})),this.default={layout:"topRight",theme:"relax",timeout:"3000",progressBar:!1}}}class timer_NotImplementedError extends Error{}class AbstractTimer{constructor(e){(0,_.Z)(this,"set_callback",(e=>{this._callback=e})),(0,_.Z)(this,"start",(()=>{this._timer||(this._timer=setInterval(this._callback,this._period))})),(0,_.Z)(this,"stop",(()=>{clearInterval(this._timer),this._timer=null})),this._callback=()=>{throw new timer_NotImplementedError},this._period=e,this._timer=null}}const B={set_count(e){this._set_box("__COUNT__","__COUNT__",e)},get_count(){return this._get_box("__COUNT__","__COUNT__")},is_count_settled(){return null!==this._get_box("__COUNT__","__COUNT__").value}};class VueCountableFlatRepository extends VueFlatRepository{}Object.assign(VueFlatRepository.prototype,B);const j=new AbstractTimer(5e3),T=new AbstractTimer(2e3);class AbstractUnitOfWork{constructor(){(0,_.Z)(this,"collect_new_messages",(()=>{const e=[...this.messages];return this.messages=[],e})),(0,_.Z)(this,"push_message",(e=>{this.messages.push(e)})),this.messages=[]}}class VueUnitOfWork extends AbstractUnitOfWork{constructor(){super(),this.api=(new HttpApiProvider).get(),this.notificator=new NotyNotificator,this.token_timer=j,this.get_files_timer=T,this.user_repository=new VueUserRepository("users"),this.action_repository=new VueCountableFlatRepository("user_actions"),this.action_repository.set_count(0),this.cdn_server_repository=new VueFlatRepository("cdn_servers"),this.token_repository=new VueTokenRepository("tokens"),this.link_repository=new VueFlatRepository("file_share_links"),this.file_repository=new VueFileFlatRepository("files"),this.download_progress=new VueFileFlatRepository("download_progress"),this.api.set_auth_token(this.token_repository.get_access_token())}}var O={name:"NavigationComponent",props:{links:{type:Array,required:!0}},setup(){const e=new VueUnitOfWork,t=e.user_repository.get_current();return{user:t}}},U=s(3744);const P=(0,U.Z)(O,[["render",NavigationComponentvue_type_template_id_4379e5f5_render]]);var Z=P,W={components:{NavigationComponent:Z},name:"BasePage",setup(){const e=[{route_name:"LoginPage",title:"Вход"},{route_name:"MainPage",title:"Главная"},{route_name:"ServersPage",title:"CDN"}];return{navigation_links:e}}};const H=(0,U.Z)(W,[["render",BasePagevue_type_template_id_a72634be_render]]);var M=H,G={components:{BasePage:M},name:"App",setup(){(0,a.JJ)("download_progress",{}),(0,a.JJ)("users",{}),(0,a.JJ)("tokens",{}),(0,a.JJ)("cdn_servers",{}),(0,a.JJ)("user_actions",{}),(0,a.JJ)("files",{}),(0,a.JJ)("file_share_links",{})}};const $=(0,U.Z)(G,[["render",render]]);var K=$,Y=s(2201);const J={class:"page"},V={class:"page__input-block"},X={class:"page__button-block"};function LoginPagevue_type_template_id_4cf0db28_scoped_true_render(e,t,s,n,i,o){const l=(0,a.up)("heading-component"),_=(0,a.up)("form-text-input"),d=(0,a.up)("btn-component");return(0,a.wg)(),(0,a.iD)("div",J,[(0,a.Wm)(l,{class:"page__heading",text:"Вход",size:"middle"}),(0,a._)("form",V,[(0,a.Wm)(_,{class:"page__input",value:n.credentials.username,onUpdate:t[0]||(t[0]=e=>n.credentials.username=e),onKeyup:(0,r.D2)(n.login_action,["enter"]),parameters:{placeholder:"Логин"},autocomplete:"username"},null,8,["value","onKeyup"]),(0,a.Wm)(_,{class:"page__input",value:n.credentials.password,onUpdate:t[1]||(t[1]=e=>n.credentials.password=e),onKeyup:(0,r.D2)(n.login_action,["enter"]),parameters:{placeholder:"Пароль",secure:!0},autocomplete:"current-password"},null,8,["value","onKeyup"])]),(0,a._)("div",X,[(0,a.Wm)(d,{class:"page__button",onClick:n.login_action,caption:"Войти",type:"primary"},null,8,["onClick"]),n.is_authenticated?((0,a.wg)(),(0,a.j4)(d,{key:0,class:"page__button",onClick:n.logout_action,caption:"Выйти",type:"secondary"},null,8,["onClick"])):(0,a.kq)("",!0)])])}class Command{}class Notify extends Command{constructor(e,t){super(),this.level=e,this.text=t}}class NotifyApiError extends Command{constructor(e){super(),this.code=e}}class LoginWithCredentials extends Command{constructor(e,t){super(),this.username=e,this.password=t}}class Logout extends Command{}class MyCredentials extends Command{}class RefreshTokens extends Command{}class GetCdnServers extends Command{}class AddCdnServer extends Command{constructor(e,t,s,r,a,n,i,o,l){super(),this.name=e,this.host=t,this.port=s,this.location=r,this.zone=a,this.latitude=n,this.longitude=i,this.is_on=o,this.is_active=l}}class UpdateCdnServer extends Command{constructor(e,t,s,r,a,n,i,o,l,_){super(),this.id=e,this.name=t,this.host=s,this.port=r,this.location=a,this.zone=n,this.latitude=i,this.longitude=o,this.is_on=l,this.is_active=_}}class DeleteCdnServer extends Command{constructor(e){super(),this.id=e}}class GetUserActions extends Command{constructor(e,t){super(),this.page_num=e,this.page_size=t}}class GetFiles extends Command{}class GetFileServers extends Command{constructor(e){super(),this.id=e}}class DeleteFile extends Command{constructor(e){super(),this.id=e}}class RenameFile extends Command{constructor(e,t){super(),this.id=e,this.name=t}}class DownloadFile extends Command{constructor(e){super(),this.id=e}}class UploadFile extends Command{constructor(e){super(),this.file=e}}class UploadFileByLink extends Command{constructor(e,t,s){super(),this.id=e,this.link=t,this.file=s}}class DownloadFileByLink extends Command{constructor(e,t,s){super(),this.link=e,this.name=t,this.size=s}}class AddFileShareLink extends Command{constructor(e,t,s){super(),this.id=e,this.lifetime=t,this.password=s}}class GetFileShareLinks extends Command{constructor(e){super(),this.file_id=e}}class FlushFileShareLinks extends Command{}class GetFileShareLink extends Command{constructor(e,t){super(),this.file_id=e,this.link_id=t}}class DeleteFileShareLink extends Command{constructor(e,t){super(),this.file_id=e,this.link_id=t}}class DownloadFileByFileShareLink extends Command{constructor(e,t,s){super(),this.file_id=e,this.link_id=t,this.password=s}}class Event{}class ApiError extends Event{constructor(e){super(),this.code=e}}class UserLoginSuccess extends Event{}class RefreshTokenOutdated extends Event{}class UserLogoutSuccess extends Event{}class UploadFileError extends Event{constructor(e){super(),this.filename=e}}class UploadFileTooBigError extends UploadFileError{}class UploadFileSuccess extends Event{}class DownloadFileSuccess extends Event{}class RenameFileSuccess extends Event{}class DeleteFileSuccess extends Event{}class FileShareLinkCopied extends Event{}class FileShareLinkDeleted extends Event{}class CdnServerAdded extends Event{}class CdnServerUpdated extends Event{}class CdnServerDeleted extends Event{}class WrongErrorType extends Error{}const notify=(e,t)=>{const s={success:t.notificator.success,warning:t.notificator.warning,info:t.notificator.info,error:t.notificator.error};if(!Object.prototype.hasOwnProperty.call(s,e.level))throw new WrongErrorType('Wrong error type "'+e.level+'"');s[e.level](e.text)},notify_api_error=(e,t)=>{const s={"User.DoesNotExist":["error","Неверные учетные данные"],"File.DoesNotExist":["error","Файл не существует"],"File.AlreadyExists":["error","Файл с таким именем уже существует"],"FileShareLink.DoesNotExist":["error","Ссылка на файл не существует либо ее срок действия истек"],"CdnServer.ConnectionError":["error","CDN сервер не отвечает"],"CdnServer.AlreadyExists":["error","Сервер уже существует"],"Auth.Error.TokenMissed":["error",null],"Auth.Error.TokenOutdated":["error",null],"Auth.Error.WrongTokenPayload":["error",null],"Auth.Error.NoPermission":["error","Недостаточно прав"],"Database.Error":["error","Ошибка базы данных"],"Request.Error.Validation":["error","Неверный запрос"],"Api.Server.Unavailable":["error","Сервер недоступен"],"Api.Server.InternalError":["error","Ошибка сервера"]};if(!Object.prototype.hasOwnProperty.call(s,e.code))return console.log('Неизвестный код ответа API "'+e.code+'"'),void t.push_message(new Notify("error","Неизвестная ошибка"));const[r,a]=s[e.code];a&&t.push_message(new Notify(r,a))};class User{constructor(e,t,s,r,a,n){this._username=e,this._email=t,this._first_name=s,this._last_name=r,this._is_superuser=a,this._permissions=n}reset(){this._username="",this._email="",this._first_name="",this._last_name="",this._is_superuser=!1,this._permissions=[]}get username(){return this._username}get email(){return this._email}get first_name(){return this._first_name}get last_name(){return this._last_name}get is_superuser(){return this._is_superuser}get permissions(){return this._permissions}}class CdnServer{constructor(e,t,s,r,a,n,i,o,l,_,d,c){this._id=e,this._name=t,this._host=s,this._port=r,this._location=a,this._zone=n,this._latitude=i,this._longitude=o,this._is_on=l,this._is_active=_,this._created=d,this._updated=c}get to_dict(){return{id:this._id,name:this._name,host:this._host,port:this._port,location:this._location,zone:this._zone,latitude:this._latitude,longitude:this._longitude,is_on:this._is_on,is_active:this._is_active,created:this._created,updated:this._updated}}get id(){return this._id}get name(){return this._name}get host(){return this._host}get port(){return this._port}get location(){return this._location}get zone(){return this._zone}get latitude(){return this._latitude}get longitude(){return this._longitude}get is_on(){return this._is_on}get is_active(){return this._is_active}get created(){return this._created}get updated(){return this._updated}}class UserAction{constructor(e,t,s,r){this._id=e,this._event=t,this._data=s,this._created=r}get id(){return this._id}get created(){return this._created}get text(){return"FILE.UPLOADED"===this._event?this._file_uploaded_text:"FILE.DOWNLOADED"===this._event?this._file_downloaded_text:"FILE.RENAMED"===this._event?this._file_renamed_text:"FILE.DELETED"===this._event?this._file_deleted_text:"FILE_SHARE_LINK.CREATED"===this._event?this._file_share_link_created_text:"FILE_SHARE_LINK.DELETED"===this._event?this._file_share_link_deleted_text:`Wrong event ${this._event}`}get _file_uploaded_text(){return`Файл "${this._data["name"]}" был добавлен`}get _file_downloaded_text(){return`Файл "${this._data["name"]}" был скачан`}get _file_renamed_text(){return`Файл "${this._data["old_name"]}" был переименован в "${this._data["new_name"]}"`}get _file_deleted_text(){return`Файл "${this._data["name"]}" был удален`}get _file_share_link_created_text(){return`Создана общедоступная ссылка на файл "${this._data["name"]}"`}get _file_share_link_deleted_text(){return`Общедоступная ссылка на файл "${this._data["name"]}", созданная ${new Date(this._data["created"]).toLocaleString("ru-RU",{timeZone:"Europe/Moscow"})}, была удалена`}}class ShareLink{constructor(e,t,s,r,a){this._id=e,this._file=t,this._is_secured=s,this._expire_at=r,this._created=a}get id(){return this._id}get file(){return this._file}get is_secured(){return this._is_secured}get expire_at(){return this._expire_at}get is_expired(){return!(null===this._expire_at||this._expire_at>Date.now())}get created(){return this._created}get text(){const e=this._expire_at?"до "+this._expire_at.toLocaleString("ru-RU",{timeZone:"Europe/Moscow"}):"бессрочно";return`${this._is_secured?", защищенная паролем":" без пароля"}. Действует ${e}.`}}class File{constructor(e,t,s,r,a){this._id=e,this._name=t,this._total_size=s,this._servers=[],this._created=r,this._updated=a,this._uploaded_size=0}get id(){return this._id}get name(){return this._name}get size(){return this._total_size}get servers(){return this._servers}get names_of_servers(){return this._servers.map((e=>e.name))}set servers(e){this._servers=e}get created(){return this._created}get updated(){return this._updated}set_total_size(e){this._total_size=e}_formatBytes(e,t){if(0==e)return"0 Bytes";var s=1024,r=t||2,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,n)).toFixed(r))+" "+a[n]}formatted_size(e){return this._formatBytes(this._total_size,e)}get progress(){return Math.floor(this._uploaded_size/this._total_size*100)}get uploaded(){return this._uploaded_size>=this._total_size}set_size_complete(){this._uploaded_size=this._total_size}set_size(e){e<0?this._uploaded_size=0:e>this._total_size?this._uploaded_size=this._total_size:e>this._uploaded_size&&(this._uploaded_size=e)}}class WrongResponseError extends Error{}const convert_user_response_obj_to_model=e=>{const t=new User(e.username,e.email,e.first_name,e.last_name,e.is_superuser,e.permissions);return t},login_with_credentials=async(e,t)=>{t.user_repository.reset_keeping_refs(),t.token_repository.reset();const s=new LoginCredentialsRequest({username:e.username,password:e.password}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof LoginCredentialsResponse)return t.token_repository.set_access_token(r.data.access_token),t.token_repository.set_refresh_token(r.data.refresh_token),t.api.set_auth_token(r.data.access_token),void t.push_message(new UserLoginSuccess);throw new WrongResponseError}t.push_message(new ApiError(r.data.code))},my_credentials=async(e,t)=>{const s=new MyCredentialsRequest,r=await t.api.call(s);if(r instanceof NegativeResponse)t.push_message(new ApiError(r.data.code));else{if(!(r instanceof MyCredentialsResponse))throw new WrongResponseError;t.user_repository.set_current(convert_user_response_obj_to_model(r.data))}},refresh_tokens=async(e,t)=>{const s=t.token_repository.get_access_token(),r=t.token_repository.get_refresh_token();if(console.log("CURRENT REFRESH TOKEN",r),!r)return void t.push_message(new RefreshTokenOutdated);if(s)return;t.api.set_auth_token(r);const a=new RefreshTokensRequest,n=await t.api.call(a);if(!(n instanceof NegativeResponse)){if(n instanceof RefreshTokensResponse)return t.token_repository.set_access_token(n.data.access_token),t.token_repository.set_refresh_token(n.data.refresh_token),t.api.set_auth_token(n.data.access_token),void t.token_timer.start();throw new WrongResponseError}"Auth.Error.TokenOutdated"===n.data.code?t.push_message(new RefreshTokenOutdated):t.push_message(new ApiError(n.data.code))},logout=async(e,t)=>{const s=new LogoutRequest,r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof LogoutResponse)return t.user_repository.reset(),t.token_repository.reset(),void t.push_message(new UserLogoutSuccess);throw new WrongResponseError}t.push_message(new ApiError(r.data.code))},convert_user_action_response_obj_to_model=e=>{const t=new UserAction(e.id,e.event,e.data,new Date(e.created));return t},get_user_actions=async(e,t)=>{t.action_repository.reset_keeping_refs();const s=new GetUserActionsRequest({page_num:e.page_num,page_size:e.page_size}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof GetUserActionsResponse)return t.action_repository.set_count(r.data.count),void r.data.data.forEach((e=>t.action_repository.set(e.id,convert_user_action_response_obj_to_model(e))));throw new WrongResponseError}t.push_message(new ApiError(r.data.code))};class cdn_server_handlers_WrongResponseError extends Error{}const convert_cdn_server_response_obj_to_model=e=>{const t=new CdnServer(e.id,e.name,e.host,e.port,e.location,e.zone,e.latitude,e.longitude,e.is_on,e.is_active,e.created,e.updated);return t},get_cdn_servers=async(e,t)=>{const s=new GetCdnServersRequest,r=await t.api.call(s);if(r instanceof NegativeResponse)t.push_message(new ApiError(r.data.code));else{if(!(r instanceof GetCdnServersResponse))throw new cdn_server_handlers_WrongResponseError;r.data.forEach((e=>t.cdn_server_repository.set(e.id,convert_cdn_server_response_obj_to_model(e))))}},add_cdn_server=async(e,t)=>{const s=new AddCdnServerRequest({name:e.name,host:e.host,port:e.port,location:e.location,zone:e.zone,latitude:e.latitude,longitude:e.longitude,is_on:e.is_on,is_active:e.is_active}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof AddCdnServerResponse){const e=r.data;return t.cdn_server_repository.set(e.id,convert_cdn_server_response_obj_to_model(e)),void t.push_message(new CdnServerAdded)}throw new cdn_server_handlers_WrongResponseError}t.push_message(new ApiError(r.data.code))},update_cdn_server=async(e,t)=>{const s=new UpdateCdnServerRequest({id:e.id,name:e.name,host:e.host,port:e.port,location:e.location,zone:e.zone,latitude:e.latitude,longitude:e.longitude,is_on:e.is_on,is_active:e.is_active}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof UpdateCdnServerResponse){const e=r.data;return t.cdn_server_repository.set(e.id,convert_cdn_server_response_obj_to_model(e)),void t.push_message(new CdnServerUpdated)}throw new cdn_server_handlers_WrongResponseError}t.push_message(new ApiError(r.data.code))},delete_cdn_server=async(e,t)=>{const s=new DeleteCdnServerRequest({id:e.id}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof DeleteCdnServerResponse)return t.cdn_server_repository.delete(e.id),void t.push_message(new CdnServerDeleted);throw new cdn_server_handlers_WrongResponseError}t.push_message(new ApiError(r.data.code))},get_file_servers=async(e,t)=>{const s=new GetFileServersRequest({id:e.id}),r=await t.api.call(s);if(r instanceof NegativeResponse)t.push_message(new ApiError(r.data.code));else{if(!(r instanceof GetFileServersResponse))throw new cdn_server_handlers_WrongResponseError;{const s=r.data.map((e=>convert_cdn_server_response_obj_to_model(e)));t.file_repository.set_servers(e.id,s)}}},get_extension_of_file=e=>e.split(".").pop()||"",js_download_file=({data:e,filename:t,mime:s,bom:r,inline:a=!1})=>{console.log(t);const n="application/pdf"===s||"pdf"==get_extension_of_file(t).toLowerCase(),i="text/html"===s||"html"===get_extension_of_file(t).toLowerCase(),o="undefined"!==typeof r?[r,e]:[e];!s&&n&&(s="application/pdf"),!s&&i&&(s="text/html");const l=new Blob(o,{type:s});if("undefined"!==typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(l,t);else{var _=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(l):window.webkitURL.createObjectURL(l);const e=document.createElement("a");e.style.display="none",e.href=_;const s=document.createElement("title");s.innerText=t,"undefined"===typeof e.download&&e.setAttribute("target","_blank"),!0===a&&(n||i)?e.addEventListener("click",(function(e){e.preventDefault();let t=window.open(_,"_blank");t.onload=()=>t.document.head.appendChild(s)})):e.setAttribute("download",t),document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e),window.URL.revokeObjectURL(_)}),5e3)}};var Q=s(5934);class file_handlers_WrongResponseError extends Error{}const convert_file_response_obj_to_model=e=>{const t=new File(e.id,e.name,e.size,new Date(e.created),new Date(e.updated));return t},get_files=async(e,t)=>{const s=new GetFilesRequest,r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof GetFilesResponse)return t.file_repository.reset_keeping_refs(),void r.data.forEach((e=>{const s=convert_file_response_obj_to_model(e);s.set_size_complete(),t.file_repository.set(s.id,s)}));throw new file_handlers_WrongResponseError}t.push_message(new ApiError(r.data.code))},delete_file=async(e,t)=>{const s=new DeleteFileRequest({id:e.id}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof DeleteFileResponse)return t.file_repository.delete(e.id),void t.push_message(new DeleteFileSuccess);throw new file_handlers_WrongResponseError}t.push_message(new ApiError(r.data.code))},rename_file=async(e,t)=>{const s=new RenameFileRequest({id:e.id,name:e.name}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof RenameFileResponse){const e=convert_file_response_obj_to_model(r.data);return e.set_size_complete(),t.file_repository.set(e.id,e),void t.push_message(new RenameFileSuccess)}throw new file_handlers_WrongResponseError}t.push_message(new ApiError(r.data.code))},upload_file=async(e,t)=>{const s=new GetUploadLinkRequest({name:e.file.name,size:e.file.size}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof GetUploadLinkResponse){const s=convert_file_response_obj_to_model(r.data.file);return t.file_repository.set(s.id,s),void t.push_message(new UploadFileByLink(s.id,r.data.link,e.file))}throw new file_handlers_WrongResponseError}t.push_message(new ApiError(r.data.code))},upload_file_by_link=async(e,t)=>{const s=t.file_repository.get(e.id),r=new UploadFileRequest({link:e.link,original_file:e.file,on_progress:e=>s.value.set_size(e)});let a=null;try{a=await t.api.call(r)}catch(n){t.push_message(new UploadFileError(e.file.name)),console.log(n)}if(a instanceof NegativeResponse)return t.file_repository.delete(e.id),void t.push_message(new ApiError(a.data.code));if(a instanceof UploadFileResponse)return t.file_repository.set_size_complete(e.id),void t.push_message(new UploadFileSuccess);throw t.file_repository.delete(e.id),new file_handlers_WrongResponseError},download_file=async(e,t)=>{const s=new GetDownloadLinkRequest({id:e.id}),r=await t.api.call(s);if(r instanceof NegativeResponse)t.push_message(new ApiError(r.data.code));else{if(!(r instanceof GetDownloadLinkResponse))throw new file_handlers_WrongResponseError;t.push_message(new DownloadFileByLink(r.data.link,r.data.file.name,r.data.file.size))}},download_file_by_link=async(e,t)=>{const s=(0,Q.Z)(),r=new File(s,e.name,e.size,new Date,new Date);console.log(r),t.download_progress.set(s,r);const a=new DownloadFileRequest({set_size_method:e=>t.download_progress.set_size(s,e),link:e.link}),n=await t.api.call(a);if(!(n instanceof NegativeResponse)){if(n instanceof DownloadFileResponse)return js_download_file({data:n.data.file,filename:e.name}),void t.push_message(new DownloadFileSuccess);throw new file_handlers_WrongResponseError}t.push_message(new ApiError(n.data.code))},convert_file_link_response_obj_to_model=e=>{const t=convert_file_response_obj_to_model(e.file),s=new ShareLink(e.id,t,e.is_secured,e.expire_at?new Date(e.expire_at):null,new Date(e.created));return s},add_file_share_link=async(e,t)=>{const s=new AddFileShareLinkRequest({id:e.id,lifetime:e.lifetime,password:e.password}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof AddFileShareLinkResponse){const e=convert_file_link_response_obj_to_model(r.data);return t.link_repository.set(e.id,e),e}throw new file_handlers_WrongResponseError}t.push_message(new ApiError(r.data.code))},get_file_share_links=async(e,t)=>{t.link_repository.reset_keeping_refs();const s=new GetFileShareLinksRequest({file_id:e.file_id}),r=await t.api.call(s);if(r instanceof NegativeResponse)t.push_message(new ApiError(r.data.code));else{if(!(r instanceof GetFileShareLinksResponse))throw new file_handlers_WrongResponseError;r.data.forEach((e=>{const s=convert_file_link_response_obj_to_model(e);t.link_repository.set(s.id,s)}))}},flush_file_share_links=async(e,t)=>{t.link_repository.reset_keeping_refs()},get_file_share_link=async(e,t)=>{const s=new GetFileShareLinkRequest({file_id:e.file_id,link_id:e.link_id}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof GetFileShareLinkResponse)return convert_file_link_response_obj_to_model(r.data);throw new file_handlers_WrongResponseError}t.push_message(new ApiError(r.data.code))},delete_file_share_link=async(e,t)=>{const s=new DeleteFileShareLinkRequest({file_id:e.file_id,link_id:e.link_id}),r=await t.api.call(s);if(!(r instanceof NegativeResponse)){if(r instanceof DeleteFileShareLinkResponse)return console.log("LINK BEFORe",JSON.stringify(t.link_repository.values().map((e=>e.value.id)))),console.log("LINK BEFORe",JSON.stringify(t.link_repository.pure_keys())),console.log("DELETE LINK",e.link_id),console.log("LINK AFTER",JSON.stringify(t.link_repository.values().map((e=>e.value.id)))),console.log("LINK AFTER",JSON.stringify(t.link_repository.pure_keys())),t.link_repository.delete(e.link_id),void t.push_message(new FileShareLinkDeleted);throw new file_handlers_WrongResponseError}t.push_message(new ApiError(r.data.code))},download_file_by_file_share_link=async(e,t)=>{const s=new GetDownloadLinkByFileShareLinkRequest({file_id:e.file_id,link_id:e.link_id,password:e.password}),r=await t.api.call(s);if(r instanceof NegativeResponse)t.push_message(new ApiError(r.data.code));else{if(!(r instanceof GetDownloadLinkByFileShareLinkResponse))throw new file_handlers_WrongResponseError;t.push_message(new DownloadFileByLink(r.data.link,r.data.file.name,r.data.file.size))}},handle_api_error=(e,t)=>{t.push_message(new NotifyApiError(e.code))},user_login_success=async(e,t)=>{t.push_message(new Notify("success","Вы вошли в систему"))},access_token_outdated=async(e,t)=>{t.push_message(new Notify("error","Время жизни Access Token истекло"))},refresh_token_outdated=async(e,t)=>{t.push_message(new Notify("error","Время жизни Refresh Token истекло. Пожалуйста, войдите заново.")),ta.push({name:"LoginPage"})},user_logout_success=(e,t)=>{t.push_message(new Notify("info","Вы вышли из системы"))},upload_file_error=(e,t)=>{t.push_message(new Notify("error",`Ошибка загрузки файла ${e.filename}`))},upload_file_success=(e,t)=>{t.push_message(new Notify("success","Файл добавлен"))},download_file_success=(e,t)=>{t.push_message(new Notify("success","Файл скачан"))},rename_file_success=(e,t)=>{t.push_message(new Notify("success","Файл переименован"))},delete_file_success=(e,t)=>{t.push_message(new Notify("success","Файл удален"))},file_share_link_copied=(e,t)=>{t.push_message(new Notify("success","Ссылка на файл скопирована в буфер обмена"))},file_share_link_deleted=(e,t)=>{t.push_message(new Notify("success","Ссылка на файл удалена"))},cdn_server_added=(e,t)=>{t.push_message(new Notify("success","Сервер добавлен"))},cdn_server_updated=(e,t)=>{t.push_message(new Notify("success","Сервер обновлен"))},cdn_server_deleted=(e,t)=>{t.push_message(new Notify("success","Сервер удален"))},ee={Notify:[notify],NotifyApiError:[notify_api_error],LoginWithCredentials:[login_with_credentials],MyCredentials:[my_credentials],RefreshTokens:[refresh_tokens],Logout:[logout],GetUserActions:[get_user_actions],GetCdnServers:[get_cdn_servers],AddCdnServer:[add_cdn_server],UpdateCdnServer:[update_cdn_server],DeleteCdnServer:[delete_cdn_server],GetFiles:[get_files],GetFileServers:[get_file_servers],DeleteFile:[delete_file],RenameFile:[rename_file],UploadFile:[upload_file],UploadFileByLink:[upload_file_by_link],DownloadFile:[download_file],DownloadFileByLink:[download_file_by_link],AddFileShareLink:[add_file_share_link],GetFileShareLinks:[get_file_share_links],FlushFileShareLinks:[flush_file_share_links],GetFileShareLink:[get_file_share_link],DeleteFileShareLink:[delete_file_share_link],DownloadFileByFileShareLink:[download_file_by_file_share_link]},te={ApiError:[handle_api_error],UserLoginSuccess:[user_login_success],AccessTokenOutdated:[access_token_outdated],RefreshTokenOutdated:[refresh_token_outdated],UserLogoutSuccess:[user_logout_success],UploadFileError:[upload_file_error],UploadFileSuccess:[upload_file_success],DownloadFileSuccess:[download_file_success],DeleteFileSuccess:[delete_file_success],RenameFileSuccess:[rename_file_success],FileShareLinkCopied:[file_share_link_copied],FileShareLinkDeleted:[file_share_link_deleted],CdnServerAdded:[cdn_server_added],CdnServerUpdated:[cdn_server_updated],CdnServerDeleted:[cdn_server_deleted]};class message_bus_NotImplementedError extends Error{}class MessageBus{static async handle(e,t){let s=[],r=[e];while(1){if(0===r.length)break;const handle_function=async e=>{if(e instanceof Command){const a=await this.handle_command(e,t,s);r=r.concat(a)}if(e instanceof Event){const s=await this.handle_event(e,t);r=r.concat(s)}},e=r.map(handle_function);r=[],await Promise.all(e)}return s}static async handle_command(e,t,s){let r=[];if(!Object.prototype.hasOwnProperty.call(ee,e.constructor.name))throw new message_bus_NotImplementedError('There is no handler for command "'+e.constructor.name+'"');const a=ee[e.constructor.name],handle_function=async a=>{try{const n=await a(e,t);s.push(n);const i=t.collect_new_messages();r=r.concat(i)}catch(n){console.log('Exception "'+n.toString()+'" handling command "'+e.constructor.name+'"')}},n=a.map(handle_function);return await Promise.all(n),r}static async handle_event(e,t){let s=[];if(!Object.prototype.hasOwnProperty.call(te,e.constructor.name))throw new message_bus_NotImplementedError('There is no handler for event "'+e.constructor.name+'"');const r=te[e.constructor.name],handle_function=async r=>{try{await r(e,t);const a=t.collect_new_messages();s=s.concat(a)}catch(a){console.log('Exception "'+a.toString()+'" handling event "'+e.constructor.name+'"')}},a=r.map(handle_function);return await Promise.all(a),s}}const se=["disabled"];function BtnComponentvue_type_template_id_6615cd5c_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("button",{class:(0,i.C_)(["btn",{btn_primary:"primary"===s.type,btn_secondary:"secondary"===s.type,btn_success:"success"===s.type,btn_warning:"warning"===s.type,btn_danger:"danger"===s.type,btn_disabled:!0===s.disabled,btn_small:"small"===s.size,btn_middle:"middle"===s.size,btn_big:"big"===s.size}]),disabled:s.disabled},(0,i.zw)(s.caption),11,se)}var re={name:"BtnComponent",props:{caption:{type:String,required:!0},type:{type:String,required:!0},disabled:{type:Boolean,required:!1,default:!1},size:{type:String,required:!1,default:"middle"}}};const ae=(0,U.Z)(re,[["render",BtnComponentvue_type_template_id_6615cd5c_render]]);var ne=ae;function HeadingComponentvue_type_template_id_e0de76cc_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("p",{class:(0,i.C_)(["heading",{heading_big:"big"===s.size,heading_middle:"middle"===s.size,heading_small:"small"===s.size}])},(0,i.zw)(s.text),3)}var ie={name:"HeadingComponent",props:{text:{type:String,required:!0},size:{type:String,required:!0}}};const oe=(0,U.Z)(ie,[["render",HeadingComponentvue_type_template_id_e0de76cc_render]]);var le=oe;const _e={class:"formtextinput"},de=["type","value","placeholder","disabled"];function FormTextInputvue_type_template_id_fae75948_scoped_true_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",_e,[(0,a._)("input",{class:"textinput",style:(0,i.j5)(r.style),type:!0===r.secure?"password":"text",value:s.value,placeholder:r.placeholder,disabled:r.is_disabled,onInput:t[0]||(t[0]=t=>e.$emit("update",t.target.value))},null,44,de)])}var ce={name:"FormTextInput",props:{parameters:{type:Object,required:!1,default:()=>({})},value:{type:String,required:!1}},emits:["update"],setup(e,{emit:t}){const s=e.parameters["default"]||"";void 0!==e.value&&null!==e.value||t("update",s);const r=(0,a.Fl)((()=>e.parameters["height"]||0)),n=(0,a.Fl)((()=>0==r.value?{color:_.value}:{color:_.value,"min-height":r.value.toString()+"px","max-height":r.value.toString()+"px"})),i=(0,a.Fl)((()=>e.parameters["placeholder"]||"")),o=(0,a.Fl)((()=>e.parameters["secure"]||!1)),l=(0,a.Fl)((()=>e.parameters["is_disabled"]||!1)),_=(0,a.Fl)((()=>e.parameters["color"]||"black"));return{placeholder:i,secure:o,is_disabled:l,color:_,style:n}}};const ue=(0,U.Z)(ce,[["render",FormTextInputvue_type_template_id_fae75948_scoped_true_render],["__scopeId","data-v-fae75948"]]);var pe=ue,me={components:{BtnComponent:ne,HeadingComponent:le,FormTextInput:pe},name:"LoginPage",setup(){const e=(0,d.qj)({username:"",password:""}),t=(0,Y.tv)(),s=(0,Y.yj)(),r=new VueUnitOfWork,a=r.user_repository.get_current(),n=r.user_repository.is_authenticated(),login_action=async()=>{const a=new LoginWithCredentials(e.username,e.password);await MessageBus.handle(a,r),r.token_repository.get_access_token()&&t.push({path:void 0===s.query.url?"/":decodeURIComponent(s.query.url)})},logout_action=async()=>{const e=new Logout;await MessageBus.handle(e,r)};return console.log("----------------------------------"),r.token_timer.stop(),r.get_files_timer.stop(),{is_authenticated:n,user:a,credentials:e,login_action:login_action,logout_action:logout_action,uow:r}}};const ge=(0,U.Z)(me,[["render",LoginPagevue_type_template_id_4cf0db28_scoped_true_render],["__scopeId","data-v-4cf0db28"]]);var he=ge;const MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId=e=>((0,a.dD)("data-v-28488e4e"),e=e(),(0,a.Cn)(),e),fe={class:"page"},ve={class:"page__container"},we={key:0,class:"page__form-backdrop"},ye={class:"page__topcontainer"},be={class:"page__infocontainer"},ke={key:0,class:"page__userinfo"},Fe={class:"page__userrow"},xe=MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId((()=>(0,a._)("p",{class:"page__userlabel"},"Имя пользователя:",-1))),Re={class:"page__uservalue"},qe={class:"page__userrow"},Se=MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId((()=>(0,a._)("p",{class:"page__userlabel"},"E-mail:",-1))),De={class:"page__uservalue"},Ee={class:"page__userrow"},Ce=MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId((()=>(0,a._)("p",{class:"page__userlabel"},"Имя:",-1))),ze={class:"page__uservalue"},Ne={class:"page__userrow"},Ie=MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId((()=>(0,a._)("p",{class:"page__userlabel"},"Фамилия:",-1))),Le={class:"page__uservalue"},Ae={class:"page__userrow"},Be=MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId((()=>(0,a._)("p",{class:"page__userlabel"},"Суперпользователь ?:",-1))),je={class:"page__uservalue"},Te={class:"page__userrow"},Oe=MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId((()=>(0,a._)("p",{class:"page__userlabel"},"Разрешения:",-1))),Ue={class:"page__uservalue"},Pe={key:1,class:"page__fileinfo"},Ze={class:"page__filecontainer"},We={key:0,class:"page__dropzonetitle"},He={class:"page__historycontainer hystorycontainer"},Me={class:"history__date"},Ge={class:"history__text"},$e={class:"page__linkcontainer linkcontainer"},Ke=["onClick"],Ye={class:"link__date"},Je={key:0,class:"link__text link__text_expired"},Ve={key:1,class:"link__text"},Xe=["href"],Qe={class:"page__middlecontainer"},et={class:"filerowheader"},tt=MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId((()=>(0,a._)("div",{class:"filerow__button"},null,-1))),st=MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId((()=>(0,a._)("div",{class:"filerow__name"},"Наименование",-1))),rt=MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId((()=>(0,a._)("div",{class:"filerow__date"},"Создан",-1))),at=MainPagevue_type_template_id_28488e4e_scoped_true_withScopeId((()=>(0,a._)("div",{class:"filerow__date"},"Изменен",-1))),nt={class:"filerow__selector"},it={class:"filerow__button"},ot=["onClick"],lt={class:"filerow__name"},_t={class:"filerow__date"},dt={class:"filerow__date"};function MainPagevue_type_template_id_28488e4e_scoped_true_render(e,t,s,r,n,o){const l=(0,a.up)("heading-component"),_=(0,a.up)("base-form"),d=(0,a.up)("form-text-field"),c=(0,a.up)("form-text-input"),u=(0,a.up)("btn-component"),p=(0,a.up)("file-list"),m=(0,a.up)("file-drop-zone"),g=(0,a.up)("document-pagination-row"),h=(0,a.up)("form-boolean-input"),f=(0,a.up)("file-block");return(0,a.wg)(),(0,a.iD)("div",fe,[(0,a.Wm)(l,{class:"page__heading",text:"Распределенное хранение файлов",size:"middle"}),(0,a._)("div",ve,[r.is_form_opened?((0,a.wg)(),(0,a.iD)("div",we,[(0,a.Wm)(_,{class:"page__form",attributes:r.form_attributes,settings:r.form_pages,onUpdate:t[0]||(t[0]=e=>r.handle_update_form_attribute(e.name,e.value)),onClose:t[1]||(t[1]=e=>r.handle_form_close()),onApply:t[2]||(t[2]=e=>r.handle_form_apply())},null,8,["attributes","settings"])])):(0,a.kq)("",!0),(0,a._)("div",ye,[(0,a._)("div",be,[r.user?((0,a.wg)(),(0,a.iD)("div",ke,[(0,a._)("div",Fe,[xe,(0,a._)("p",Re,(0,i.zw)(r.user.username),1)]),(0,a._)("div",qe,[Se,(0,a._)("p",De,(0,i.zw)(r.user.email),1)]),(0,a._)("div",Ee,[Ce,(0,a._)("p",ze,(0,i.zw)(r.user.first_name),1)]),(0,a._)("div",Ne,[Ie,(0,a._)("p",Le,(0,i.zw)(r.user.last_name),1)]),(0,a._)("div",Ae,[Be,(0,a._)("p",je,(0,i.zw)(r.user.is_superuser?"Да":"Нет"),1)]),(0,a._)("div",Te,[Oe,(0,a._)("ul",Ue,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.user.permissions,(e=>((0,a.wg)(),(0,a.iD)("li",{key:e},(0,i.zw)(e),1)))),128))])])])):(0,a.kq)("",!0),r.selected_file_id?((0,a.wg)(),(0,a.iD)("div",Pe,[(0,a.Wm)(d,{value:"Сменить имя файла",parameters:{font_weight:600}}),(0,a.Wm)(c,{value:r.selected_file_name,onUpdate:t[3]||(t[3]=e=>r.selected_file_name=e)},null,8,["value"]),r.selected_file_name?((0,a.wg)(),(0,a.j4)(u,{key:0,"или":"",class:"fileinfo__button",caption:"Применить",type:"success",onClick:t[4]||(t[4]=e=>r.handle_rename_file())})):(0,a.kq)("",!0)])):(0,a.kq)("",!0)]),(0,a._)("div",Ze,[(0,a.Wm)(p,{files:r.downloading_files,can_be_deleted:!1,"или":"",can_be_dragged:!1},null,8,["files"]),(0,a.Wm)(m,{class:(0,i.C_)(["page__filedropzone",{page__filedropzone_dragging:r.is_drag_above_file_zone}]),"onAdd:file":t[5]||(t[5]=e=>r.handle_new_file_drop(e)),"onUpdate:dragging":t[6]||(t[6]=e=>r.is_drag_above_file_zone=e)},{default:(0,a.w5)((()=>[r.is_drag_above_file_zone?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("span",We," Drag&Drop < "+(0,i.zw)(r.max_file_size)+" МБ",1))])),_:1},8,["class"]),(0,a.Uk)(" или "),(0,a._)("input",{type:"file",id:"file-input",multiple:"",onChange:t[7]||(t[7]=e=>Array.prototype.forEach.call(e.target.files,(e=>r.handle_new_file_drop(e))))},null,32)]),(0,a._)("div",He,[(0,a.Wm)(d,{value:"История действий пользователя:",parameters:{font_weight:600}}),(0,a.Wm)(g,{total_count:r.ua_total_count,count_per_page:r.ua_count_per_page,current_page:r.ua_current_page,variants:r.ua_variants,"onSet:count_per_page":t[8]||(t[8]=e=>r.ua_select_count_per_page(e)),"onSelect:page":t[9]||(t[9]=e=>r.ua_select_page(e))},null,8,["total_count","count_per_page","current_page","variants"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.user_actions,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"historycontainer__row history__row"},[(0,a._)("div",Me,(0,i.zw)(e.created.toLocaleString("ru-RU",{timeZone:"Europe/Moscow"})),1),(0,a._)("div",Ge,(0,i.zw)(e.text),1)])))),128))]),(0,a._)("div",$e,[(0,a.Wm)(d,{value:"Общедоступные ссылки (выберите файл):",parameters:{font_weight:600}}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.share_links,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"linkcontainer__row link__row"},[(0,a._)("div",{class:"link__delete",onClick:t=>r.handle_delete_link(e.id)},null,8,Ke),(0,a._)("div",Ye,(0,i.zw)(e.created.toLocaleString("ru-RU",{timeZone:"Europe/Moscow"})),1),e.is_expired?((0,a.wg)(),(0,a.iD)("div",Je," Истекло время жизни ссылки ")):((0,a.wg)(),(0,a.iD)("div",Ve,[(0,a._)("a",{href:r.make_share_link_for_selected_file(e.id)},"Ссылка",8,Xe),(0,a.Uk)((0,i.zw)(e.text),1)]))])))),128))])]),(0,a._)("div",Qe,[(0,a._)("div",et,[tt,st,rt,at,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.servers,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"filerow__server server"},[(0,a._)("p",null,(0,i.zw)(e.name),1),(0,a._)("p",null,(0,i.zw)(e.location),1),(0,a._)("p",null,(0,i.zw)(e.zone),1),(0,a._)("p",null,"Ш: "+(0,i.zw)(e.latitude),1),(0,a._)("p",null,"Д: "+(0,i.zw)(e.longitude),1),r.can_change_server?((0,a.wg)(),(0,a.j4)(h,{key:0,class:"server__activator",value:e.is_active,parameters:{size:20,hint:"Активен"},onUpdate:t=>r.handle_activate_server(e,t)},null,8,["value","onUpdate"])):(0,a.kq)("",!0)])))),128))]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.files,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.id,class:(0,i.C_)(["filerow",{filerow_selected:e.id===r.selected_file_id}])},[(0,a._)("div",nt,[(0,a.Wm)(h,{value:e.id===r.selected_file_id,parameters:{size:26},onClick:t=>r.handle_select_file(e.id,e.name)},null,8,["value","onClick"])]),(0,a._)("div",it,[(0,a._)("div",{class:"filerow__img filerow__img_delete",onClick:t=>r.handle_delete(e.id)},null,8,ot)]),(0,a._)("div",lt,[(0,a.Wm)(f,{file:e,"onDownload:file":t=>r.handle_download(e.id),"onCopy_link_to:file":t=>r.handle_copy_link(e.id)},null,8,["file","onDownload:file","onCopy_link_to:file"])]),(0,a._)("div",_t,(0,i.zw)(e.created.toLocaleString("ru-RU",{timeZone:"Europe/Moscow"})),1),(0,a._)("div",dt,(0,i.zw)(e.updated.toLocaleString("ru-RU",{timeZone:"Europe/Moscow"})),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.servers,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.name,class:"filerow__server"},[(0,a._)("div",{class:(0,i.C_)(["filerow__img",{filerow__img_yes:e.names_of_servers.includes(t.name),filerow__img_no:!e.names_of_servers.includes(t.name)}])},null,2)])))),128))],2)))),128))])])])}s(8525);const DocumentPaginationRowvue_type_template_id_6eebb904_scoped_true_withScopeId=e=>((0,a.dD)("data-v-6eebb904"),e=e(),(0,a.Cn)(),e),ct={class:"documentpaginationrow"},ut=DocumentPaginationRowvue_type_template_id_6eebb904_scoped_true_withScopeId((()=>(0,a._)("span",null,"По",-1))),pt=DocumentPaginationRowvue_type_template_id_6eebb904_scoped_true_withScopeId((()=>(0,a._)("span",null," | Страницы ",-1))),mt={key:0,class:"documentpaginationrow__container"},gt={key:1,class:"documentpaginationrow__container"};function DocumentPaginationRowvue_type_template_id_6eebb904_scoped_true_render(e,t,s,r,n,o){const l=(0,a.up)("text-button");return(0,a.wg)(),(0,a.iD)("div",ct,[ut,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.variants,(t=>((0,a.wg)(),(0,a.iD)("div",{class:"documentpaginationrow__variants",key:t},[(0,a.Wm)(l,{class:(0,i.C_)(["documentpaginationrow__textbutton",{documentpaginationrow__textbutton_active:t===s.count_per_page}]),title:t.toString(),onClick:s=>{e.$emit("select:page",1),e.$emit("set:count_per_page",t)}},null,8,["class","title","onClick"])])))),128)),pt,!s.is_intermediate_part_shown&&r.has_intermediate_part?((0,a.wg)(),(0,a.iD)("div",mt,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.pages_before,(t=>((0,a.wg)(),(0,a.iD)("div",{class:"documentpaginationrow__subcontainer",key:t.index},[(0,a.Wm)(l,{class:(0,i.C_)(["documentpaginationrow__textbutton",{documentpaginationrow__textbutton_active:t.index===s.current_page}]),title:t.index.toString(),onClick:s=>e.$emit("select:page",t.index)},null,8,["class","title","onClick"])])))),128)),(0,a.Wm)(l,{class:"documentpaginationrow__textbutton",title:"...",onClick:t[0]||(t[0]=t=>e.$emit("show:pages"))}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.pages_after,(t=>((0,a.wg)(),(0,a.iD)("div",{class:"documentpaginationrow__subcontainer",key:t.index},[(0,a.Wm)(l,{class:(0,i.C_)(["documentpaginationrow__textbutton",{documentpaginationrow__textbutton_active:t.index===s.current_page}]),title:t.index.toString(),onClick:s=>e.$emit("select:page",t.index)},null,8,["class","title","onClick"])])))),128))])):((0,a.wg)(),(0,a.iD)("div",gt,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.pages,(t=>((0,a.wg)(),(0,a.iD)("div",{class:"documentpaginationrow__subcontainer",key:t.index},[(0,a.Wm)(l,{class:(0,i.C_)(["documentpaginationrow__textbutton",{documentpaginationrow__textbutton_active:t.index===s.current_page}]),title:t.index.toString(),onClick:s=>e.$emit("select:page",t.index)},null,8,["class","title","onClick"])])))),128))]))])}function TextButtonvue_type_template_id_2869d17a_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["textbutton",{textbutton_disabled:s.disabled}])},(0,i.zw)(s.title),3)}var ht={name:"TextButton",props:{title:{type:String,required:!0},disabled:{type:Boolean,required:!1,default:!1}}};const ft=(0,U.Z)(ht,[["render",TextButtonvue_type_template_id_2869d17a_render]]);var vt=ft,wt={components:{TextButton:vt},name:"DocumentPaginationRow",props:{total_count:{type:Number,required:!0},count_per_page:{type:Number,required:!0},current_page:{type:Number,required:!0},variants:{type:Array,required:!0},max_count_of_pages:{type:Number,required:!1,default:0},count_before:{type:Number,required:!1,default:10},count_after:{type:Number,required:!1,default:5},is_intermediate_part_shown:{type:Boolean,required:!1,default:!0}},emits:["select:page","set:count_per_page","set:page_range","show:pages"],setup(e,{emit:t}){const s=(0,a.Fl)((()=>Array.from(Array(Math.ceil(e.total_count/e.count_per_page)).keys()).map((t=>{const s=t*e.count_per_page,r=(t+1)*e.count_per_page-1;return{index:t+1,min:s,max:Math.min(r,e.total_count-1)}})))),r=(0,a.Fl)((()=>s.value.length-e.count_before-e.count_after>0)),n=(0,a.Fl)((()=>s.value.filter((t=>t.index<=e.count_before)))),i=(0,a.Fl)((()=>s.value.filter((t=>t.index>=s.value.length-e.count_after+1)))),o=(0,a.Fl)((()=>s.value.find((t=>t.index===e.current_page))));return(0,a.YP)(o,(e=>t("set:page_range",e))),(0,a.bv)((()=>t("set:page_range",o.value))),{page:o,pages:s,has_intermediate_part:r,pages_before:n,pages_after:i}}};const yt=(0,U.Z)(wt,[["render",DocumentPaginationRowvue_type_template_id_6eebb904_scoped_true_render],["__scopeId","data-v-6eebb904"]]);var bt=yt;function FileDropZonevue_type_template_id_1310559a_render(e,t,s,n,i,o){return(0,a.wg)(),(0,a.iD)("div",{class:"filedropzone",onDrop:t[0]||(t[0]=(0,r.iM)((e=>n.handleDrop(e)),["prevent"])),onDragover:t[1]||(t[1]=(0,r.iM)((()=>{}),["prevent"])),onDragenter:t[2]||(t[2]=(0,r.iM)((e=>n.is_dragging=!0),["prevent"])),onDragleave:t[3]||(t[3]=(0,r.iM)((e=>n.is_dragging=!1),["prevent"]))},[(0,a.WI)(e.$slots,"default")],32)}var kt={name:"FileDropZone",props:{filename_pattern:{type:Object,required:!1,default:()=>/.*/}},emits:["add:file","update:dragging","wrong:filename"],setup(e,{emit:t}){const s=(0,d.iH)(!1),r=new RegExp(e.filename_pattern),handleDrop=e=>{s.value=!1,Array.prototype.forEach.call(e.dataTransfer.files,(e=>{e.name.toString().match(r)?t("add:file",e):t("wrong:filename",e.name.toString())}))};return(0,a.YP)(s,((e,s)=>{e!==s&&t("update:dragging",e)})),{handleDrop:handleDrop,is_dragging:s}}};const Ft=(0,U.Z)(kt,[["render",FileDropZonevue_type_template_id_1310559a_render]]);var xt=Ft;const Rt={key:0,class:"fileblock"},qt=["draggable"],St={key:1,class:"fileblock__title"};function FileBlockvue_type_template_id_940c9aaa_render(e,t,s,r,n,o){const l=(0,a.up)("form-text-input"),_=(0,a.up)("toggle-text-button");return 100===s.file.progress?((0,a.wg)(),(0,a.iD)("div",Rt,[s.can_be_deleted?((0,a.wg)(),(0,a.iD)("span",{key:0,class:"fileblock__deletebutton",onClick:t[0]||(t[0]=t=>e.$emit("delete:file"))},"(X) ")):(0,a.kq)("",!0),r.is_rename_active?((0,a.wg)(),(0,a.j4)(l,{key:1,class:"fileblock__input",value:r.filename,onUpdate:t[1]||(t[1]=e=>r.filename=e)},null,8,["value"])):((0,a.wg)(),(0,a.iD)("a",{key:2,class:"fileblock__link",href:"#",draggable:s.can_be_dragged,onDragstart:t[2]||(t[2]=e=>r.handle_drag_start(e)),onDragend:t[3]||(t[3]=t=>e.$emit("dragend:file")),onClick:t[4]||(t[4]=t=>{!0===r.is_uploaded&&e.$emit("download:file",!1)})},(0,i.zw)(s.file.name)+" ("+(0,i.zw)(s.file.formatted_size())+")",41,qt)),(0,a._)("span",{class:"fileblock__linkbutton",onClick:t[5]||(t[5]=t=>e.$emit("copy_link_to:file"))},"🔗 "),s.can_be_renamed&&r.filename.length>0?((0,a.wg)(),(0,a.j4)(_,{key:3,class:(0,i.C_)(["fileblock__renamebutton",{fileblock__renamebutton_red:r.is_rename_active}]),activeTitle:"Сохранить",passiveTitle:"Переименовать",isActive:r.is_rename_active,onClick:t[6]||(t[6]=e=>r.handle_click_on_rename_button())},null,8,["class","isActive"])):(0,a.kq)("",!0)])):((0,a.wg)(),(0,a.iD)("span",St,(0,i.zw)(s.file.name)+" ("+(0,i.zw)(s.file.formatted_size())+")"+(0,i.zw)(r.progress_str),1))}const Dt={class:"toggletextbutton"};function ToggleTextButtonvue_type_template_id_cb9d649a_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",Dt,(0,i.zw)(s.isActive?s.activeTitle:s.passiveTitle),1)}var Et={name:"ToggleTextButton",props:{isActive:{type:Boolean,required:!0},activeTitle:{type:String,required:!0},passiveTitle:{type:String,required:!0}}};const Ct=(0,U.Z)(Et,[["render",ToggleTextButtonvue_type_template_id_cb9d649a_render]]);var zt=Ct,Nt={name:"FileBlock",components:{ToggleTextButton:zt,FormTextInput:pe},props:{file:{type:Object,required:!0},can_be_deleted:{type:Boolean,required:!1,default:!1},can_be_dragged:{type:Boolean,required:!1,default:!1},can_be_renamed:{type:Boolean,required:!1,default:!1}},emits:["delete:file","dragstart:file","dragend:file","download:file","copy_link_to:file","rename:file","rename:activated"],setup(e,{emit:t}){const s=(0,d.iH)("");(0,a.YP)((()=>e.file.progress),(e=>{s.value=e<100?` (${e}%)`:""}));const handle_drag_start=s=>{s.dataTransfer.setData("text/plain",e.file.id),t("dragstart:file")},r=(0,a.Fl)((()=>100===e.file.progress)),n=get_extension_of_file(e.file.name),i=n?e.file.name.substring(0,e.file.name.length-n.length-1):e.file.name,o=(0,d.iH)(!1),l=(0,d.iH)(i),handle_click_on_rename_button=()=>{o.value?t("rename:file",l.value+(n?"."+n:"")):t("rename:activated"),o.value=!o.value};return{progress_str:s,handle_drag_start:handle_drag_start,is_uploaded:r,is_rename_active:o,filename:l,handle_click_on_rename_button:handle_click_on_rename_button}}};const It=(0,U.Z)(Nt,[["render",FileBlockvue_type_template_id_940c9aaa_render]]);var Lt=It;const At={class:"filelist"};function FileListvue_type_template_id_15d69ea0_scoped_true_render(e,t,s,r,n,o){const l=(0,a.up)("file-block");return(0,a.wg)(),(0,a.iD)("div",At,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.files,(r=>((0,a.wg)(),(0,a.j4)(l,{class:"filelist__fileblock",key:r.id,file:r,can_be_dragged:s.can_be_dragged,can_be_deleted:s.can_be_deleted,can_be_renamed:s.can_be_renamed,"onDragstart:file":t[0]||(t[0]=t=>e.$emit("dragstart:file")),onDragend:t[1]||(t[1]=t=>e.$emit("dragend:file")),"onDownload:file":t=>e.$emit("download:file",[r,t]),"onDelete:file":t=>e.$emit("delete:file",r.id),"onRename:file":t=>e.$emit("rename:file",[r.id,t]),"onRename:activated":t=>e.$emit("rename:activated",r.id),"onCopy_link_to:file":t=>e.$emit("copy_link_to:file",r)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(r.name),1)])),_:2},1032,["file","can_be_dragged","can_be_deleted","can_be_renamed","onDownload:file","onDelete:file","onRename:file","onRename:activated","onCopy_link_to:file"])))),128))])}var Bt={components:{FileBlock:Lt},name:"FileList",props:{files:{type:Array,required:!0},can_be_dragged:{type:Boolean,required:!0},can_be_deleted:{type:Boolean,required:!0},can_be_renamed:{type:Boolean,required:!1,default:!1}},emits:["dragstart:file","dragend:file","download:file","delete:file","rename:file","rename:activated","copy_link_to:file"]};const jt=(0,U.Z)(Bt,[["render",FileListvue_type_template_id_15d69ea0_scoped_true_render],["__scopeId","data-v-15d69ea0"]]);var Tt=jt;const Ot={key:0,class:"baseform-header"},Ut={class:"baseform-header__pagenum"},Pt={class:"baseform-header__name"},Zt={class:"baseform-body"};function BaseFormvue_type_template_id_312010b1_scoped_true_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",{class:"baseform",style:(0,i.j5)({width:r.form_width.toString()+"px"})},[s.is_header_required?((0,a.wg)(),(0,a.iD)("div",Ot,[(0,a._)("div",Ut,(0,i.zw)(r.page_index+1)+".",1),(0,a._)("div",Pt,(0,i.zw)(r.page_name),1),r.page_index>0?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"baseform-header__button baseform-header__button_left",title:"Предыдущая страница",onClick:t[0]||(t[0]=e=>r.page_index=Math.max(0,r.page_index-1))})):(0,a.kq)("",!0),r.page_index<r.page_count-1?((0,a.wg)(),(0,a.iD)("div",{key:1,class:"baseform-header__button baseform-header__button_right",title:"Следующая страница",onClick:t[1]||(t[1]=e=>r.page_index=Math.min(r.page_index+1,r.page_count-1))})):(0,a.kq)("",!0),(0,a._)("div",{class:"baseform-header__button baseform-header__button_apply",title:"Сохранить",onClick:t[2]||(t[2]=t=>e.$emit("apply"))}),(0,a._)("div",{class:"baseform-header__button baseform-header__button_close",title:"Закрыть",onClick:t[3]||(t[3]=t=>e.$emit("close"))})])):(0,a.kq)("",!0),(0,a._)("div",Zt,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.page_fields,((t,n)=>((0,a.wg)(),(0,a.j4)((0,a.LL)(t.type),{class:"baseform-body__field",key:r.page_index.toString()+"|"+t.type+"|"+n.toString(),parameters:t.parameters,context:r.make_field_context(t),value:t.value?t.value:s.attributes[t.bind],onUpdate:s=>{t.bind&&e.$emit("update",{name:t.bind,value:s})}},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(s.attributes),1)])),_:2},1064,["parameters","context","value","onUpdate"])))),128))])],4)}const Wt=["title"];function FormTextFieldvue_type_template_id_43049fc2_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",{class:"formtextfield",style:(0,i.j5)({"text-align":r.align,"font-weight":r.font_weight}),title:r.hint},(0,i.zw)(s.value),13,Wt)}var Ht={name:"FormTextField",props:{parameters:{type:Object,required:!1,default:()=>({})},value:{required:!0}},setup(e){const t=(0,a.Fl)((()=>e.parameters["align"]||"left")),s=(0,a.Fl)((()=>e.parameters["font_weight"]||"normal")),r=(0,a.Fl)((()=>e.parameters["hint"]||""));return{align:t,font_weight:s,hint:r}}};const Mt=(0,U.Z)(Ht,[["render",FormTextFieldvue_type_template_id_43049fc2_render]]);var Gt=Mt;const $t=["srcdoc"];function FormHtmlFieldvue_type_template_id_be019dbe_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",{class:"formhtmlfield",style:(0,i.j5)({height:r.height.toString()+"px"})},[(0,a._)("iframe",{class:"formhtmlfield__iframe",srcdoc:s.value}," ",8,$t)],4)}var Kt={name:"FormHtmlField",props:{parameters:{type:Object,required:!1,default:()=>({})},value:{required:!0}},setup(e){const t=(0,a.Fl)((()=>e.parameters["height"]||500));return{height:t}}};const Yt=(0,U.Z)(Kt,[["render",FormHtmlFieldvue_type_template_id_be019dbe_render]]);var Jt=Yt;const Vt={class:"formbooleaninput"},Xt=["title","checked","disabled"];function FormBooleanInputvue_type_template_id_1381d60c_scoped_true_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",Vt,[(0,a._)("input",{class:"booleaninput",style:(0,i.j5)(r.style),type:"checkbox",title:r.hint,checked:s.value,disabled:r.is_disabled,onChange:t[0]||(t[0]=t=>e.$emit("update",t.target.checked))},null,44,Xt)])}var Qt={name:"FormBooleanInput",props:{parameters:{type:Object,required:!1,default:()=>({})},value:{type:Boolean,required:!1,default:void 0}},emits:["update"],setup(e,{emit:t}){const s=e.parameters["default"]||!1;void 0!==e.value&&null!==e.value||t("update",s);const r=(0,a.Fl)((()=>e.parameters["size"]||0)),n=(0,a.Fl)((()=>0==r.value?{}:{"min-width":r.value.toString()+"px","max-width":r.value.toString()+"px","min-height":r.value.toString()+"px","max-height":r.value.toString()+"px"})),i=(0,a.Fl)((()=>e.parameters["hint"]||"")),o=(0,a.Fl)((()=>e.parameters["is_disabled"]||!1));return{size:r,hint:i,is_disabled:o,style:n}}};const es=(0,U.Z)(Qt,[["render",FormBooleanInputvue_type_template_id_1381d60c_scoped_true_render],["__scopeId","data-v-1381d60c"]]);var ts=es;const ss={class:"form-multiline-text-input"},rs=["disabled","rows"];function FormMultilineTextInputvue_type_template_id_67b6f645_scoped_true_render(e,t,s,n,o,l){return(0,a.wg)(),(0,a.iD)("div",ss,[(0,a.wy)((0,a._)("textarea",{class:"multiline-text-input",style:(0,i.j5)({color:n.color,resize:n.resize}),disabled:n.is_disabled,rows:n.rows,"onUpdate:modelValue":t[0]||(t[0]=e=>n.text=e),onInput:t[1]||(t[1]=t=>e.$emit("update",t.target.value))},null,44,rs),[[r.nr,n.text]])])}var as={name:"FormMultilineTextInput",props:{parameters:{type:Object,required:!1,default:()=>({})},value:{type:String,required:!1}},emits:["update"],setup(e,{emit:t}){const s=e.parameters["default"]||"";void 0!==e.value&&null!==e.value||t("update",s);const r=(0,a.Fl)((()=>e.parameters["rows"]||10)),n=(0,a.Fl)((()=>e.parameters["is_disabled"]||!1)),i=(0,a.Fl)((()=>e.parameters["color"]||"black")),o=(0,a.Fl)((()=>e.parameters["resize"]||"none")),l=(0,d.iH)("");return(0,a.YP)((()=>e.value),(e=>l.value=e)),{rows:r,is_disabled:n,color:i,resize:o,text:l}}};const ns=(0,U.Z)(as,[["render",FormMultilineTextInputvue_type_template_id_67b6f645_scoped_true_render],["__scopeId","data-v-67b6f645"]]);var is=ns;const os=["value","disabled"];function FormDateInputvue_type_template_id_41f62af6_render(e,t,s,r,n,i){return(0,a.wg)(),(0,a.iD)("input",{class:"formdateinput",type:"date",value:r.date_str,onInput:t[0]||(t[0]=e=>r.handle_update_date(e)),disabled:r.is_disabled},null,40,os)}var ls={name:"FormDateInput",props:{parameters:{type:Object,required:!1,default:()=>({})},value:{type:Number,required:!1}},emits:["update"],setup(e,{emit:t}){const s=e.parameters["default"]||0;void 0!==e.value&&null!==e.value||t("update",s);const r=e.parameters["is_disabled"]||!1,n=(0,a.Fl)((()=>{const t=new Date(1e3*(e.value||s));return t.toISOString().slice(0,10)})),handle_update_date=e=>t("update",Math.floor(e.target.valueAsNumber/1e3)||0);return{date_str:n,is_disabled:r,handle_update_date:handle_update_date}}};const _s=(0,U.Z)(ls,[["render",FormDateInputvue_type_template_id_41f62af6_render]]);var ds=_s;const cs={class:"formemailaddressfield"};function FormEmailToAddressFieldvue_type_template_id_2e722576_scoped_true_render(e,t,s,r,n,i){const o=(0,a.up)("form-text-field");return(0,a.wg)(),(0,a.iD)("div",cs,[r.to?((0,a.wg)(),(0,a.j4)(o,{key:0,class:"formemailaddressfield__label",parameters:{font_weight:"bold"},value:"Кому:"})):(0,a.kq)("",!0),r.to?((0,a.wg)(),(0,a.j4)(o,{key:1,class:"formemailaddressfield__address",value:r.convert(r.to)},null,8,["value"])):(0,a.kq)("",!0),r.cc?((0,a.wg)(),(0,a.j4)(o,{key:2,class:"formemailaddressfield__label",parameters:{font_weight:"bold"},value:"Копия:"})):(0,a.kq)("",!0),r.cc?((0,a.wg)(),(0,a.j4)(o,{key:3,class:"formemailaddressfield__address",value:r.convert(r.cc)},null,8,["value"])):(0,a.kq)("",!0),r.bcc?((0,a.wg)(),(0,a.j4)(o,{key:4,class:"formemailaddressfield__label",parameters:{font_weight:"bold"},value:"Скрытая копия:"})):(0,a.kq)("",!0),r.bcc?((0,a.wg)(),(0,a.j4)(o,{key:5,class:"formemailaddressfield__address",value:r.convert(r.bcc)},null,8,["value"])):(0,a.kq)("",!0)])}var us={name:"FormEmailToAddressField",components:{FormTextField:Gt},props:{parameters:{type:Object,required:!1,default:()=>({})},value:{type:Object,required:!0}},setup(e){const t=(0,a.Fl)((()=>e.value||{TO:"",CC:"",BCC:""})),s=(0,a.Fl)((()=>t.value["TO"])),r=(0,a.Fl)((()=>t.value["CC"])),n=(0,a.Fl)((()=>t.value["BCC"])),convert=e=>e.split(" ").join("; ");return{to:s,cc:r,bcc:n,convert:convert}}};const ps=(0,U.Z)(us,[["render",FormEmailToAddressFieldvue_type_template_id_2e722576_scoped_true_render],["__scopeId","data-v-2e722576"]]);var ms=ps;const FormEmailToAddressInputvue_type_template_id_c2578df8_scoped_true_withScopeId=e=>((0,a.dD)("data-v-c2578df8"),e=e(),(0,a.Cn)(),e),gs={class:"formemailaddressinput"},hs={class:"formemailaddressinput__container"},fs={class:"formemailaddressinput__header"},vs={class:"formemailaddressinput__rowcontainer"},ws=["title","onClick"],ys={class:"formemailaddressinput__description"},bs={class:"formemailaddressinput__email"},ks=FormEmailToAddressInputvue_type_template_id_c2578df8_scoped_true_withScopeId((()=>(0,a._)("div",{class:"formemailaddressinput__@"},"@",-1))),Fs={class:"formemailaddressinput__domain"};function FormEmailToAddressInputvue_type_template_id_c2578df8_scoped_true_render(e,t,s,r,n,o){const l=(0,a.up)("form-text-field"),_=(0,a.up)("form-text-input");return(0,a.wg)(),(0,a.iD)("div",gs,[(0,a._)("div",hs,[(0,a.Wm)(l,{class:"formemailaddressinput__label",parameters:{align:"center"},value:0==r.variant_idx?"Текущее письмо":"Адресаты из прошлых писем: "+r.variant_idx.toString()},null,8,["value"]),(0,a._)("div",fs,[(0,a._)("div",{class:(0,i.C_)(["formemailaddressinput__button formemailaddressinput__button_left",{formemailaddressinput__button_inactive:r.variant_idx===r.variant_count-1}]),onClick:t[0]||(t[0]=e=>r.goto_next_letter()),title:"Предыдущее письмо"},null,2),(0,a._)("div",{class:(0,i.C_)(["formemailaddressinput__button formemailaddressinput__button_right",{formemailaddressinput__button_inactive:0===r.variant_idx}]),title:"Следующее письмо",onClick:t[1]||(t[1]=e=>r.goto_previous_letter())},null,2),(0,a.Wm)(_,{class:"formemailaddressinput__search",parameters:r.search_field_parameters,value:r.search_query,onUpdate:t[2]||(t[2]=e=>r.search_query=e)},null,8,["parameters","value"]),(0,a._)("div",{class:(0,i.C_)(["formemailaddressinput__button formemailaddressinput__button_add",{formemailaddressinput__button_inactive:!1===r.validate_email(r.search_query)||r.variant_idx>0}]),onClick:t[3]||(t[3]=e=>r.add_email(r.search_query)),title:"Добавить e-mail"},null,2),(0,a._)("div",{class:(0,i.C_)(["formemailaddressinput__button formemailaddressinput__button_approve",{formemailaddressinput__button_inactive:0===r.variant_idx||""!=r.search_query}]),onClick:t[4]||(t[4]=e=>r.use_the_letter_as_current()),title:"Использовать адресатов из данного письма"},null,2)]),(0,a._)("div",vs,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.sorted_current_variant,(e=>((0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["formemailaddressinput__row",{formemailaddressinput__row_to:1==e.designation,formemailaddressinput__row_cc:2==e.designation,formemailaddressinput__row_bcc:3==e.designation}]),key:e.full_email,title:r.get_row_title(e.designation),onClick:t=>r.change_designation(e.full_email)},[(0,a._)("div",ys,(0,i.zw)(e.description),1),(0,a._)("div",bs,(0,i.zw)(e.email),1),ks,(0,a._)("div",Fs,(0,i.zw)(e.domain),1)],10,ws)))),128))])])])}s(1295);var xs={name:"FormEmailToAddressInput",components:{FormTextInput:pe,FormTextField:Gt},props:{parameters:{type:Object,required:!1,default:()=>({})},context:{type:Object,required:!1,default:()=>({})},value:{type:Object,required:!1}},emits:["update"],setup(e,{emit:t}){const s=e.parameters["default"]||{TO:"",CC:"",BCC:""};void 0!==e.value&&null!==e.value||t("update",s);const r=(0,a.Fl)((()=>e.context["ADDRESS"])),n=(0,a.Fl)((()=>e.context["KNOWN_EMAILS"])),address_decode_str=(e,t,s)=>{t&&t.split(" ").filter((e=>""!=e)).forEach((t=>e[t]=s))},address_decode=e=>{let t={};return address_decode_str(t,e["NA"],4),address_decode_str(t,e["BCC"],3),address_decode_str(t,e["CC"],2),address_decode_str(t,e["TO"],1),Object.entries(t).map((([e,t])=>({description:n.value&&n.value[e]||"",email:e.split("@")[0],domain:e.split("@")[1],full_email:e,designation:t})))},address_encode=e=>{let t={1:[],2:[],3:[],4:[]};return e.forEach((e=>t[e.designation].push(e.full_email))),{TO:t[1].join(" "),CC:t[2].join(" "),BCC:t[3].join(" ")}},i=(0,a.Fl)((()=>{let t=[];return e.value&&(t=t.concat(e.value["TO"],e.value["CC"],e.value["BCC"])),r.value&&r.value.forEach((e=>t=t.concat(e["TO"]||[]).concat(e["CC"]||[]).concat(e["BCC"]||[]))),n.value&&(t=t.concat(Object.keys(n.value))),{NA:t.filter((e=>""!=e)).join(" ")}})),o=(0,a.Fl)((()=>{let t=[address_decode(Object.assign({},e.value,i.value))];return r.value?(r.value.forEach((e=>t.push(address_decode(e)))),t):t})),l=(0,d.iH)(0),_=(0,a.Fl)((()=>o.value.length)),c=(0,a.Fl)((()=>o.value[l.value])),goto_previous_letter=()=>{l.value=Math.max(0,l.value-1)},goto_next_letter=()=>{l.value=Math.min(l.value+1,_.value-1)},use_the_letter_as_current=()=>{0!=l.value&&""==u.value&&(t("update",r.value[l.value-1]),l.value=0)},get_row_title=e=>{switch(e){case 1:return"Кому";case 2:return"Копия";case 3:return"Скрытая копия";default:return null}},validate_email=e=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e),add_email=e=>{if(!1===validate_email(e)||l.value>0)return;let s=structuredClone(c.value);s.push({description:"",designation:1,domain:"",email:"",full_email:e.toLowerCase()}),t("update",address_encode(s)),u.value=""},next_designation=e=>4==e?1:e+1,change_designation=e=>{if(l.value>0)return;let s=structuredClone(c.value);s.forEach((t=>{t.full_email===e&&(t.designation=next_designation(t.designation))})),t("update",address_encode(s))},u=(0,d.iH)(""),p={placeholder:"Введите email или имя пользователя..",height:30},m=(0,a.Fl)((()=>c.value.filter((e=>e.description.toLowerCase().includes(u.value.toLowerCase())||(e.email+"@"+e.domain).toLowerCase().includes(u.value.toLowerCase()))))),g=(0,a.Fl)((()=>{let e=structuredClone(m.value);return e.sort(((e,t)=>{let s=0;return 4!=e.designation&&4!=t.designation||(s=e.designation-t.designation),0!=s?s:(s=e.description.localeCompare(t.description),0!=s||(s=e.email.localeCompare(t.email)),s)})),e}));return{variants:o,variant_idx:l,variant_count:_,current_variant:c,sorted_current_variant:g,search_query:u,search_field_parameters:p,obj_with_all_NA_addresses:i,change_designation:change_designation,get_row_title:get_row_title,goto_previous_letter:goto_previous_letter,goto_next_letter:goto_next_letter,use_the_letter_as_current:use_the_letter_as_current,validate_email:validate_email,add_email:add_email}}};const Rs=(0,U.Z)(xs,[["render",FormEmailToAddressInputvue_type_template_id_c2578df8_scoped_true_render],["__scopeId","data-v-c2578df8"]]);var qs=Rs;const Ss={class:"formhtmlinput"};function FormHtmlInputvue_type_template_id_74cfadbf_render(e,t,s,r,n,o){const l=(0,a.up)("ckeditor");return(0,a.wg)(),(0,a.iD)("div",Ss,[(0,a.Wm)(l,{id:"formhtmlinput-editor",class:"formhtmlinput__editor",style:(0,i.j5)({height:r.height}),modelValue:r.body_html,"onUpdate:modelValue":t[0]||(t[0]=e=>r.body_html=e),config:r.editor_config,onNamespaceloaded:r.onNamespaceLoaded},null,8,["style","modelValue","config","onNamespaceloaded"])])}var Ds={name:"FormHtmlInput",props:{parameters:{type:Object,required:!1,default:()=>({})},value:{type:String,required:!1}},setup(e,{emit:t}){const s=(0,a.Fl)((()=>e.parameters["height"]||500)),r=(0,a.Fl)((()=>e.parameters["default"]||"")),n=(0,d.iH)(e.value||r.value),i=s.value-30,o={fullPage:!0,allowedContent:!0,extraPlugins:["autogrow","colorbutton"],resize_enabled:!1,autoGrow_minHeight:i,autoGrow_maxHeight:i,toolbar:[{name:"clipboard",items:["Undo"]},{name:"basicstyles",items:["Bold","Italic","RemoveFormat"]},{name:"colorbutton",items:["BGColor","TextColor"]}],colorButton_colors:"000,800000,8B4513,2F4F4F,008080,000080,4B0082,696969,B22222,A52A2A,DAA520,006400,40E0D0,0000CD,800080,808080,F00,FF8C00,FFD700,008000,0FF,00F,EE82EE,A9A9A9,FFA07A,FFA500,FFFF00,00FF00,AFEEEE,ADD8E6,DDA0DD,D3D3D3,FFF0F5,FAEBD7,FFFFE0,F0FFF0,F0FFFF,F0F8FF,E6E6FA,FFF",removePlugins:"elementspath"},onNamespaceLoaded=e=>{e.plugins.addExternal("colorbutton","/colorbutton/")};return(0,a.YP)(n,(e=>t("update",e))),{height:s,body_html:n,editor_config:o,onNamespaceLoaded:onNamespaceLoaded}}};const Es=(0,U.Z)(Ds,[["render",FormHtmlInputvue_type_template_id_74cfadbf_render]]);var Cs=Es;const zs=["disabled","size"],Ns=["selected","value"];function FormSelectInputvue_type_template_id_20d58ba5_scoped_true_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("select",{class:"formselectinput",disabled:r.is_disabled,size:r.size.toString(),onInput:t[0]||(t[0]=e=>r.handle_choose_value(e.target.value))},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.parameters.options,((e,t)=>((0,a.wg)(),(0,a.iD)("option",{selected:void 0!==s.value&&null!==s.value&&e.value===s.value,key:e.value,value:t},(0,i.zw)(e.name),9,Ns)))),128))],40,zs)}var Is={name:"FormSelectInput",props:{parameters:{type:Object,required:!1,default:()=>({})},value:{required:!1}},emits:["update"],setup(e,{emit:t}){const s=e.parameters["default"]||"";void 0!==e.value&&null!==e.value||!s||t("update",s);const r=(0,a.Fl)((()=>e.parameters["size"]||1)),n=(0,a.Fl)((()=>e.parameters["is_disabled"]||!1)),handle_choose_value=s=>{t("update",e.parameters.options[parseInt(s)].value)};return{size:r,is_disabled:n,handle_choose_value:handle_choose_value}}};const Ls=(0,U.Z)(Is,[["render",FormSelectInputvue_type_template_id_20d58ba5_scoped_true_render],["__scopeId","data-v-20d58ba5"]]);var As=Ls;const Bs={class:"formfilteredselectinput"};function FormFilteredSelectInputvue_type_template_id_3d606cee_scoped_true_render(e,t,s,r,n,i){const o=(0,a.up)("form-select-input"),l=(0,a.up)("form-text-input");return(0,a.wg)(),(0,a.iD)("div",Bs,[(0,a.Wm)(o,{class:"formfilteredselectinput__target",parameters:{options:s.parameters.options,is_disabled:r.is_disabled},value:s.value,onMousedown:t[0]||(t[0]=e=>r.handle_click_on_target(e))},null,8,["parameters","value"]),r.is_selected?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(l,{key:0,class:"formfilteredselectinput__search",parameters:{placeholder:r.placeholder,height:30},value:r.query,onUpdate:t[1]||(t[1]=e=>r.query=e)},null,8,["parameters","value"])),r.is_selected?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(o,{key:1,class:"formfilteredselectinput__list",parameters:{options:r.filtered_options,size:r.size},value:s.value,onUpdate:t[2]||(t[2]=t=>{e.$emit("update",t),r.is_selected=!r.is_selected})},null,8,["parameters","value"]))])}var js={name:"FormFilteredSelectInput",components:{FormTextInput:pe,FormSelectInput:As},props:{parameters:{type:Object,required:!1,default:()=>({})},value:{required:!1}},emits:["update"],setup(e,{emit:t}){const s=e.parameters["default"]||"";void 0!==e.value&&null!==e.value||!s||t("update",s);const r=(0,a.Fl)((()=>e.parameters["size"]||3)),n=(0,a.Fl)((()=>e.parameters["is_disabled"]||!1)),i=(0,a.Fl)((()=>e.parameters["placeholder"]||"")),o=(0,d.iH)(!0),l=(0,d.iH)(""),_=(0,a.Fl)((()=>e.parameters.options.filter((e=>e.name.toUpperCase().includes(l.value.toUpperCase()))))),handle_click_on_target=e=>{e.preventDefault(),!0!==n.value&&(o.value=!o.value)};return{size:r,is_disabled:n,placeholder:i,is_selected:o,query:l,filtered_options:_,handle_click_on_target:handle_click_on_target}}};const Ts=(0,U.Z)(js,[["render",FormFilteredSelectInputvue_type_template_id_3d606cee_scoped_true_render],["__scopeId","data-v-3d606cee"]]);var Os=Ts,Us={name:"BaseForm",components:{FormTextField:Gt,FormHtmlField:Jt,FormBooleanInput:ts,FormTextInput:pe,FormMultilineTextInput:is,FormEmailToAddressField:ms,FormEmailToAddressInput:qs,FormDateInput:ds,FormHtmlInput:Cs,FormSelectInput:As,FormFilteredSelectInput:Os},props:{settings:{type:Object,required:!0},context:{type:Object,required:!1,default:()=>({})},attributes:{type:Object,required:!0},is_header_required:{type:Boolean,required:!1,default:!0}},emits:["apply","close","update"],setup(e){const t=(0,d.iH)(0),s=(0,a.Fl)((()=>e.settings.length)),r=(0,a.Fl)((()=>e.settings[t.value])),n=(0,a.Fl)((()=>r.value["size"]||"w500")),i=(0,a.Fl)((()=>r.value["name"]||"")),o=(0,a.Fl)((()=>r.value["fields"]||[])),make_field_context=t=>{if(!t.bind_context)return{};let s={};return Object.keys(t.bind_context).forEach((r=>s[r]=e.context[t.bind_context[r]])),s};return{page_settings:r,page_index:t,page_count:s,page_name:i,form_width:n,page_fields:o,make_field_context:make_field_context}}};const Ps=(0,U.Z)(Us,[["render",BaseFormvue_type_template_id_312010b1_scoped_true_render],["__scopeId","data-v-312010b1"]]);var Zs=Ps;const filterArrayOfObjectsByQuery=(e,t)=>e.filter((e=>{let s=!0;return Object.keys(t).forEach((r=>{if(!s)return;const a=t[r];if(!a&&0!==a)return;let n=r.split("__");const i=n.length<=1?"exact":n.pop();let o=e;if(n.forEach((e=>o=o[e])),o||0===o)switch(i){case"exact":s=o==a;break;case"iexact":s=o.toLowerCase()==a.toLowerCase();break;case"contains":s=String.prototype.includes.call(o,a);break;case"icontains":s=String.prototype.includes.call(o.toLowerCase(),a.toLowerCase());break;case"gt":s=o>a;break;case"gte":s=o>=a;break;case"lt":s=o<a;break;case"lte":s=o<=a;break;default:console.log("Wrong comparison rule "+i.toString()+"!"),s=!1}else s=!1})),s})),useBeforeEnterPage=async e=>{const t=(0,Y.yj)(),auto_login_action=async e=>{!e.user_repository.is_authenticated()&&e.token_repository.get_access_token()&&await MessageBus.handle(new MyCredentials,e)};await auto_login_action(e),e.user_repository.is_authenticated()||ta.push({name:"LoginPage",query:{url:encodeURIComponent(t.fullPath)}})},convertStringToDate=(e,t)=>{const s=e.split(".");let r=NaN;try{return null!==t&&"lt"!==t&&"lte"!==t||(r=new Date(parseInt(s[2],10),parseInt(s[1],10)-1,parseInt(s[0],10),23,59,59)),"gt"!==t&&"gte"!==t||(r=new Date(parseInt(s[2],10),parseInt(s[1],10)-1,parseInt(s[0],10))),r}catch(a){return NaN}},useDataEncode=(e,t=null,s=null)=>{if(!s)return e;const r={date_to_timestamp:convertDateToTimestamp,date_to_iso_string:convertDateToIsoString,date_to_date_object:convertDateToDateObject},a=Object.prototype.hasOwnProperty.call(r,s)?r[s]:null;return a?a(e,t):""},useCurrentMixin=(e,t,s)=>{const r=(0,d.iH)(null),n=(0,d.iH)(convertObject(e,s)),handle_update_attribute=(e,t)=>n.value[e]=t;return(0,a.YP)(r,(e=>{if(null===e)return;const r=t.get(e).value;n.value=convertObject(r.to_dict,s)})),{current_id:r,current:n,handle_update_attribute:handle_update_attribute}},useSelectionMixin=(e,t)=>{const s=(0,d.iH)({}),r=(0,a.Fl)((()=>Object.values(s.value).filter((e=>!0===e)).length)),handle_select_item=e=>{e in s.value?s.value[e]=!s.value[e]:s.value[e]=!0},reset_selection=()=>{n.value=!1,s.value={}};(0,a.YP)((()=>e.value),(()=>reset_selection()));const n=(0,d.iH)(!1),handle_select_all_items=()=>{!0===n.value?(reset_selection(),n.value=!1):(n.value=!0,t.value.forEach((e=>s.value[e.id]=!0)))},i=(0,a.Fl)((()=>t.value.filter((e=>e.id in s.value&&!0===s.value[e.id]))));return{selected_item_ids:s,selected_items:i,count_of_selected_items:r,is_all_selected:n,handle_select_all_items:handle_select_all_items,handle_select_item:handle_select_item,reset_selection:reset_selection}},usePaginationMixin=(e,t=[20,100,500,1e3],s=100)=>{const r=(0,d.iH)(t),n=(0,d.iH)(s),i=(0,d.iH)(1),o=(0,d.iH)(0),l=(0,d.iH)(100),handle_set_page_range=(e,t)=>{o.value=e,l.value=t},_=(0,a.Fl)((()=>e.value.slice(o.value,l.value+1)));return{pagination_variants:r,pagination_count_per_page:n,pagination_current_page:i,pagination_min_index:o,pagination_max_index:l,paginated_items:_,handle_set_page_range:handle_set_page_range}},convertObject=(e,t,s=[])=>{let r={};return Object.keys(e).filter((e=>!s.includes(e))).forEach((s=>r[s]=Object.prototype.hasOwnProperty.call(t,s)?t[s](e[s]):e[s])),Object.keys(t).filter((t=>!Object.prototype.hasOwnProperty.call(e,t))).forEach((e=>r[e]=t[e]())),r},convertDateToDateObject=(e,t)=>convertStringToDate(e,t),convertDateToTimestamp=(e,t)=>{const s=convertStringToDate(e,t);return isNaN(s)?"":Math.floor(s.getTime()/1e3)},convertDateToIsoString=(e,t)=>{const s=convertStringToDate(e,t);return isNaN(s)?"":s.toISOString()},convertDateToDateTimeString=e=>e.toLocaleString("ru-RU",{timeZone:"Europe/Moscow"}),useGetSortFunction=e=>{const sort_default=(e,t)=>e===t?0:e>t?1:-1,sort_numbers=(e,t)=>e-t,sort_strings=(e,t)=>e.localeCompare(t),sort_change_order_number=(e,t)=>{try{const[s,r]=e.split("-",2),[a,n]=t.split("-",2),i=Number.parseInt(r)-Number.parseInt(n);if(0!==i)return i;const o=Number.parseInt(s)-Number.parseInt(a);return o}catch(s){return 0}};null!==e&&void 0!==e||(e="DEFAULT");const t={DEFAULT:sort_default,INTEGER:sort_numbers,STRING:sort_strings,BOOL:sort_default,DATE:sort_default,CHANGE_ORDER_NUMBER:sort_change_order_number};return Object.prototype.hasOwnProperty.call(t,e)||(e="DEFAULT"),t[e]};var Ws={components:{HeadingComponent:le,FileBlock:Lt,FileDropZone:xt,FileList:Tt,FormTextField:Gt,FormTextInput:pe,FormBooleanInput:ts,DocumentPaginationRow:bt,BaseForm:Zs,BtnComponent:ne},name:"MainPage",setup(){const e=(0,Y.tv)(),t=new VueUnitOfWork,s=100,r=(0,a.Fl)((()=>!!b.value&&b.value.permissions.includes("can_change_cdnserver"))),n=(0,a.Fl)((()=>t.cdn_server_repository.values().map((e=>e.value)).filter((e=>e.is_on)).toSorted(((e,t)=>e.zone.localeCompare(t.zone))))),handle_activate_server=async(e,s)=>{await MessageBus.handle(new UpdateCdnServer(e.id,e.name,e.host,e.port,e.location,e.zone,e.latitude,e.longitude,e.is_on,s),t)},i=(0,a.Fl)((()=>t.action_repository.values().map((e=>e.value)).toSorted(((e,t)=>t.created-e.created)))),o=t.action_repository.get_count(),l=(0,d.iH)(1),_=(0,d.iH)(10),c=(0,d.iH)([5,10]),ua_select_page=e=>l.value=e,ua_select_count_per_page=e=>_.value=e;(0,a.YP)([l,_],(async()=>{await refresh_actions()}));const refresh_actions=async()=>await MessageBus.handle(new GetUserActions(l.value,_.value),t),u=(0,a.Fl)((()=>t.file_repository.values().map((e=>e.value)))),p=(0,a.Fl)((()=>t.download_progress.values().map((e=>e.value)).filter((e=>!e.uploaded))));(0,a.YP)(u,(async e=>{e.forEach((async e=>{e.servers.length<n.value.length&&await MessageBus.handle(new GetFileServers(e.id),t)}))}));const handle_delete=async e=>{await MessageBus.handle(new FlushFileShareLinks,t),await MessageBus.handle(new DeleteFile(e),t),m.value=null,g.value="",await refresh_actions()},handle_download=async e=>{await MessageBus.handle(new DownloadFile(e),t),await refresh_actions()},m=(0,d.iH)(null),g=(0,d.iH)(""),handle_select_file=async(e,s)=>{m.value=e,g.value=s,await MessageBus.handle(new GetFileShareLinks(e),t)},handle_rename_file=async()=>{await MessageBus.handle(new RenameFile(m.value,g.value),t),await refresh_actions()},h=(0,d.iH)(!1),handle_new_file_drop=async e=>{let r=null;r=e.size>1024*s*1024?new UploadFileTooBigError(e.name):new UploadFile(e),await MessageBus.handle(r,t),await refresh_actions()},f=(0,a.Fl)((()=>{let e=t.link_repository.values().map((e=>e.value)).toSorted(((e,t)=>t.created-e.created));return e})),make_share_link=(t,s)=>{const r=e.resolve({name:"DownloadFilePage",params:{file_id:t,link_id:s}});return window.location.origin+r.href},make_share_link_for_selected_file=e=>make_share_link(m.value,e),handle_copy_link_into_clipboard=(e,s)=>{const r=make_share_link(e,s);navigator.clipboard?navigator.clipboard.writeText(r).then((()=>MessageBus.handle(new FileShareLinkCopied,t))):console.log(r)},handle_delete_link=async e=>{await MessageBus.handle(new DeleteFileShareLink(m.value,e),t)},v=(0,d.iH)(!1),w=(0,d.qj)({FILE_ID:null,LIFETIME:"0",PASSWORD:""}),handle_copy_link=e=>{handle_update_form_attribute("FILE_ID",e),m.value=e,v.value=!0},handle_form_close=()=>{v.value=!1},handle_form_apply=async()=>{const e=w["FILE_ID"];let s=Number.parseInt(w["LIFETIME"]),r=w["PASSWORD"];if(r||(r=null),isNaN(s)||s<0)return void await MessageBus.handle(new Notify("error","Время жизни должно быть целым числом"),t);0===s?s=null:s*=60,v.value=!1;const a=await MessageBus.handle(new AddFileShareLink(e,s,r),t),n=a[0];handle_copy_link_into_clipboard(e,n.id),await refresh_actions()},handle_update_form_attribute=(e,t)=>w[e]=t,y=[{size:400,name:"Создание ссылки",fields:[{type:"FormTextField",parameters:{font_weight:"bold"},value:"Время жизни ссылки в минутах (0 - бессрочно):"},{type:"FormTextInput",bind:"LIFETIME"},{type:"FormTextField",parameters:{font_weight:"bold"},value:"Пароль:"},{type:"FormTextInput",bind:"PASSWORD"}]}],refresh_tokens=async()=>await MessageBus.handle(new RefreshTokens,t);t.token_timer.set_callback(refresh_tokens),t.token_timer.start();const get_files=async()=>{u.value.forEach((async e=>{e.servers.length<n.value.length&&await MessageBus.handle(new GetFileServers(e.id),t)}))};t.get_files_timer.set_callback(get_files);const b=t.user_repository.get_current();return(0,a.bv)((async()=>{await useBeforeEnterPage(t,[]),await MessageBus.handle(new GetCdnServers,t),await MessageBus.handle(new GetFiles,t),await refresh_actions()})),{user:b,user_actions:i,ua_total_count:o,ua_current_page:l,ua_count_per_page:_,ua_variants:c,ua_select_page:ua_select_page,ua_select_count_per_page:ua_select_count_per_page,can_change_server:r,servers:n,handle_activate_server:handle_activate_server,files:u,selected_file_id:m,selected_file_name:g,handle_select_file:handle_select_file,downloading_files:p,max_file_size:s,is_drag_above_file_zone:h,handle_new_file_drop:handle_new_file_drop,handle_delete:handle_delete,handle_download:handle_download,handle_copy_link:handle_copy_link,handle_rename_file:handle_rename_file,is_form_opened:v,form_pages:y,form_attributes:w,handle_update_form_attribute:handle_update_form_attribute,handle_form_apply:handle_form_apply,handle_form_close:handle_form_close,share_links:f,make_share_link:make_share_link,make_share_link_for_selected_file:make_share_link_for_selected_file,handle_copy_link_into_clipboard:handle_copy_link_into_clipboard,handle_delete_link:handle_delete_link}}};const Hs=(0,U.Z)(Ws,[["render",MainPagevue_type_template_id_28488e4e_scoped_true_render],["__scopeId","data-v-28488e4e"]]);var Ms=Hs;const Gs={class:"page"},$s={class:"page__container"},Ks={class:"page__editblock"},Ys={class:"page__editrow"};function ServersPagevue_type_template_id_0b134db0_scoped_true_render(e,t,s,r,n,i){const o=(0,a.up)("heading-component"),l=(0,a.up)("base-form"),_=(0,a.up)("btn-component"),d=(0,a.up)("search-component");return(0,a.wg)(),(0,a.iD)("div",Gs,[(0,a.Wm)(o,{class:"page__heading",text:"CDNs",size:"middle"}),(0,a._)("div",$s,[(0,a._)("div",Ks,[(0,a.Wm)(l,{class:"page__form",attributes:r.current,settings:r.form_pages,is_edit_mode:!0,is_header_required:!1,onUpdate:t[0]||(t[0]=e=>r.handle_update_attribute(e.name,e.value))},null,8,["attributes","settings"]),(0,a._)("div",Ys,[r.can_add&&!r.current_id?((0,a.wg)(),(0,a.j4)(_,{key:0,class:"page__button",onClick:t[1]||(t[1]=e=>r.add_action()),caption:"Добавить",type:"primary",disabled:!r.is_edit_block_valid},null,8,["disabled"])):(0,a.kq)("",!0),r.can_change&&r.current_id?((0,a.wg)(),(0,a.j4)(_,{key:1,class:"page__button",onClick:t[2]||(t[2]=e=>r.update_action()),caption:"Сохранить",type:"success",disabled:!r.is_edit_block_valid},null,8,["disabled"])):(0,a.kq)("",!0),r.can_delete&&r.current_id?((0,a.wg)(),(0,a.j4)(_,{key:2,class:"page__button",onClick:t[3]||(t[3]=e=>r.delete_action()),caption:"Удалить",type:"danger"})):(0,a.kq)("",!0)])]),(0,a.Wm)(d,{class:"page__searchblock",schema:r.search_schema,model_objects:r.model_objects,convert_obj_to_item:r.convert_model_to_item,current_id:r.current_id,sort_by:"name",sort_asc:!0,search_time:r.search_time,is_searching:r.is_searching,should_emit_search_event_on_any_keypress:!0,onChoose:t[4]||(t[4]=e=>r.current_id=e),onSearch:t[5]||(t[5]=e=>r.search_action(e))},null,8,["schema","model_objects","convert_obj_to_item","current_id","search_time","is_searching"])])])}const Js={class:"searchcomponent"},Vs=["onClick"];function SearchComponentvue_type_template_id_1a8d1a54_scoped_true_render(e,t,s,r,n,o){const l=(0,a.up)("document-page-search-row"),_=(0,a.up)("document-search-status-row"),d=(0,a.up)("document-page-sort-row"),c=(0,a.up)("document-pagination-row"),u=(0,a.up)("document-attribute-row"),p=(0,a.up)("document-files-row");return(0,a.wg)(),(0,a.iD)("div",Js,[(0,a.Wm)(l,{class:"searchcomponent__searchrow",search_schema:s.schema,should_emit_search_event_on_any_keypress:s.should_emit_search_event_on_any_keypress,required_space_for_link:s.has_link,is_selection_required:s.is_selection_required,is_all_selected:!1,"onSearch:docs":t[0]||(t[0]=t=>e.$emit("search",t)),"onSelectall:docs":t[1]||(t[1]=e=>r.handle_select_all_items())},null,8,["search_schema","should_emit_search_event_on_any_keypress","required_space_for_link","is_selection_required"]),(0,a.Wm)(_,{class:"searchcomponent__searchstatus",count:r.items.length,time:s.search_time,min_index:r.pagination_min_index,max_index:r.pagination_max_index},null,8,["count","time","min_index","max_index"]),(0,a.Wm)(d,{class:"searchcomponent__sortrow",search_schema:s.schema,sort_asc:r.var_sort_asc,sort_by:r.var_sort_by,"onToggle:direction":t[2]||(t[2]=e=>r.var_sort_asc=!r.var_sort_asc),"onSort:by":t[3]||(t[3]=e=>[r.var_sort_by,r.var_sort_rule]=e)},null,8,["search_schema","sort_asc","sort_by"]),r.items.length>0?((0,a.wg)(),(0,a.j4)(c,{key:0,class:"searchcomponent__paginationrow",total_count:r.items.length,count_per_page:r.pagination_count_per_page,current_page:r.pagination_current_page,variants:r.pagination_variants,"onSet:page_range":t[4]||(t[4]=e=>r.handle_set_page_range(e.min,e.max)),"onSelect:page":t[5]||(t[5]=e=>r.pagination_current_page=e),"onSet:count_per_page":t[6]||(t[6]=e=>r.pagination_count_per_page=e)},null,8,["total_count","count_per_page","current_page","variants"])):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.paginated_items,(t=>((0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["searchcomponent__row",{searchcomponent__row_selected:s.current_id===t.id}]),key:t.id,onClick:s=>e.$emit("choose",t.id)},[(0,a.Wm)(u,{class:"searchcomponent__attributerow",id:t.id,search_schema:s.schema,has_link:s.has_link,link_route_obj:t.link_to_single_page,attributes:t.attributes,is_selection_required:s.is_selection_required,is_selected:t.id in r.selected_item_ids,"onSelect:doc":e=>r.handle_select_item(t.id)},null,8,["id","search_schema","has_link","link_route_obj","attributes","is_selection_required","is_selected","onSelect:doc"]),s.is_files_shown?((0,a.wg)(),(0,a.j4)(p,{key:0,class:"searchcomponent__filerow",files:t.attachments,"onDownload:file":s=>e.$emit("download:file",{id:t.id,file:s[0],inline:s[1]}),"onCopy_link_to:file":s=>e.$emit("copy_link_to:file",{id:t.id,file:s})},null,8,["files","onDownload:file","onCopy_link_to:file"])):(0,a.kq)("",!0)],10,Vs)))),128))])}const Xs={class:"documentpagesearchrow"};function DocumentPageSearchRowvue_type_template_id_74028ffa_scoped_true_render(e,t,s,n,i,o){const l=(0,a.up)("form-boolean-input"),_=(0,a.up)("sized-div"),d=(0,a.up)("tuning-item");return(0,a.wg)(),(0,a.iD)("div",Xs,[s.is_selection_required?((0,a.wg)(),(0,a.j4)(_,{key:0,class:"documentpagesearchrow__sizedblock",size:"w30"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{class:"documentpagesearchrow__input",value:s.is_all_selected,parameters:{size:30},onUpdate:t[0]||(t[0]=t=>e.$emit("selectall:docs"))},null,8,["value"])])),_:1})):(0,a.kq)("",!0),s.required_space_for_link?((0,a.wg)(),(0,a.j4)(_,{key:1,class:"documentpagesearchrow__sizedblock",size:"w30"})):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.search_schema,(i=>((0,a.wg)(),(0,a.j4)(_,{key:i.name,class:"documentpagesearchrow__sizedblock",size:i.size,grow:i.grow},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(i.fields,(e=>((0,a.wg)(),(0,a.j4)((0,a.LL)(n.get_component_name(e)),{class:"documentpagesearchrow__input",key:e,value:n.get_query_value(i,e),parameters:n.get_parameters(i,e),onKeyup:t[1]||(t[1]=(0,r.D2)((e=>n.emit_search_event()),["enter"])),onUpdate:t=>n.set_query_value(i,e,t)},null,40,["value","parameters","onUpdate"])))),128)),s.is_tuning_mode?((0,a.wg)(),(0,a.j4)(d,{key:0,class:"documentpagesearchrow__tuningitem",size:i.size,grow:i.grow,"onChange:size":t=>e.$emit("change:size",{name:i.name,value:t}),"onChange:grow":t=>e.$emit("change:grow",{name:i.name,value:t}),"onDelete:field":t=>e.$emit("delete:field",i.name)},null,8,["size","grow","onChange:size","onChange:grow","onDelete:field"])):(0,a.kq)("",!0)])),_:2},1032,["size","grow"])))),128))])}function SizedDivvue_type_template_id_09f6cb8c_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["sizeddiv",{sizeddiv_w30:"w30"===s.size&&!1===s.grow,sizeddiv_w35:"w35"===s.size&&!1===s.grow,sizeddiv_w40:"w40"===s.size&&!1===s.grow,sizeddiv_w50:"w50"===s.size&&!1===s.grow,sizeddiv_w100:"w100"===s.size&&!1===s.grow,sizeddiv_w150:"w150"===s.size&&!1===s.grow,sizeddiv_w200:"w200"===s.size&&!1===s.grow,sizeddiv_w250:"w250"===s.size&&!1===s.grow,sizeddiv_w300:"w300"===s.size&&!1===s.grow,sizeddiv_w350:"w350"===s.size&&!1===s.grow,sizeddiv_w400:"w400"===s.size&&!1===s.grow,sizeddiv_growable:!0===s.grow}])},[(0,a.WI)(e.$slots,"default")],2)}var Qs={name:"SizedDiv",props:{size:{type:String,required:!1,default:""},grow:{type:Boolean,required:!1,default:!1}}};const er=(0,U.Z)(Qs,[["render",SizedDivvue_type_template_id_09f6cb8c_render]]);var tr=er;const sr={class:"tuningitem"};function TuningItemvue_type_template_id_9319ab66_render(e,t,s,r,n,i){const o=(0,a.up)("icon-button");return(0,a.wg)(),(0,a.iD)("div",sr,[(0,a.Wm)(o,{class:"tuningitem__button",icon_on:"-",onClick:t[0]||(t[0]=t=>e.$emit("change:size",r.prev_size(s.size)))}),(0,a.Wm)(o,{class:"tuningitem__button",icon_on:"+",onClick:t[1]||(t[1]=t=>e.$emit("change:size",r.next_size(s.size)))}),(0,a.Wm)(o,{class:"tuningitem__button",icon_on:"⇔",icon_off:"⤄",is_active:s.grow,onClick:t[2]||(t[2]=t=>e.$emit("change:grow",!s.grow))},null,8,["is_active"]),(0,a.Wm)(o,{class:"tuningitem__button",icon_on:"X",onClick:t[3]||(t[3]=t=>e.$emit("delete:field"))})])}const rr={class:"iconbutton__icon"};function IconButtonvue_type_template_id_5f810ad4_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",{class:"iconbutton",onClick:t[0]||(t[0]=t=>e.$emit("toggle"))},[(0,a._)("div",rr,(0,i.zw)(!0===s.is_active?s.icon_on:s.icon_off),1)])}var ar={name:"IconButton",props:{icon_on:{type:String,required:!0},icon_off:{type:String,required:!1},is_active:{type:Boolean,required:!1,default:!0}}};const nr=(0,U.Z)(ar,[["render",IconButtonvue_type_template_id_5f810ad4_render]]);var ir=nr,or={components:{IconButton:ir},name:"TuningItem",props:{size:{type:String,required:!1,default:"w50"},grow:{type:Boolean,required:!1,default:!1}},emits:["change:size","change:grow","delete:field"],setup(){const e=["w50","w100","w150","w200","w250","w300","w350","w400"],prev_size=t=>{let s=e.indexOf(t)-1;return s=Math.max(0,s),e[s]},next_size=t=>{let s=e.indexOf(t)+1;return s=Math.min(s,e.length-1),e[s]};return{prev_size:prev_size,next_size:next_size}}};const lr=(0,U.Z)(or,[["render",TuningItemvue_type_template_id_9319ab66_render]]);var _r=lr,dr={name:"DocumentPageSearchRow",components:{SizedDiv:tr,FormTextInput:pe,FormSelectInput:As,FormFilteredSelectInput:Os,TuningItem:_r,FormBooleanInput:ts},props:{search_schema:{type:Object,required:!0},is_disabled:{type:Boolean,required:!1,default:!1},is_clean_required:{type:Boolean,required:!1,default:!1},is_tuning_mode:{type:Boolean,required:!1,default:!1},required_space_for_link:{type:Boolean,required:!1,default:!1},is_selection_required:{type:Boolean,required:!1,default:!1},is_all_selected:{type:Boolean,required:!1,default:!1},should_emit_search_event_on_any_keypress:{type:Boolean,required:!1,default:!1}},emits:["search:docs","selectall:docs","clean:query","change:size","change:grow","delete:field"],setup(e,{emit:t}){const s=(0,d.qj)({}),get_query_key=(e,t)=>e+"__"+t,r=(0,a.Fl)((()=>{const e={};return Object.keys(s).forEach((t=>{const r=s[t],a=r.converter?r.converter:null;let n=r.value;r.re&&!1===is_pattern_valid(r.re,r.value)&&(n=""),e[t]=""===n?n:useDataEncode(n,r.rule,a)})),e})),get_initial_value=e=>"bool"!==e&&"",reset_query=()=>{e.search_schema.forEach((e=>{e.fields.forEach((t=>{s[get_query_key(e.name,t.rule)]={type:t.type,name:e.name,rule:t.rule,re:t.re,converter:t.converter,value:get_initial_value(t.type)}}))}))},is_pattern_valid=(e,t)=>null!==String.prototype.match.call(t,new RegExp(e));(0,a.YP)((()=>e.is_clean_required),(e=>{!0===e&&(reset_query(),t("clean:query"))})),reset_query();const emit_search_event=()=>t("search:docs",r.value),get_component_name=e=>"bool"===e.type?"FormBooleanInput":"select"===e.type?"FormSelectInput":"filtered_select"===e.type?"FormFilteredSelectInput":"FormTextInput",get_query_item=(e,t)=>s[get_query_key(e.name,t.rule)],get_query_value=(e,t)=>get_query_item(e,t)["value"],set_query_value=(t,s,r)=>{get_query_item(t,s)["value"]=r,e.should_emit_search_event_on_any_keypress&&emit_search_event()},get_parameters=(e,t)=>"bool"===t.type?boolean_input_parameters(t):["select","filtered_select"].includes(t.type)?select_input_parameters(t):text_input_parameters(e,t),text_input_parameters=(t,s)=>({color:is_pattern_valid(get_query_item(t,s)["re"],get_query_item(t,s)["value"])?"":"red",placeholder:s.placeholder,is_disabled:e.is_disabled,height:30}),boolean_input_parameters=t=>({hint:t.placeholder,is_disabled:e.is_disabled,size:28}),select_input_parameters=t=>({hint:t.placeholder,is_disabled:e.is_disabled,options:t.options});return{query:s,encoded_query:r,get_query_key:get_query_key,is_pattern_valid:is_pattern_valid,get_component_name:get_component_name,get_parameters:get_parameters,get_query_value:get_query_value,set_query_value:set_query_value,emit_search_event:emit_search_event}}};const cr=(0,U.Z)(dr,[["render",DocumentPageSearchRowvue_type_template_id_74028ffa_scoped_true_render],["__scopeId","data-v-74028ffa"]]);var ur=cr;function DocumentAttributeRowvue_type_template_id_6127c01a_scoped_true_render(e,t,s,r,n,o){const l=(0,a.up)("form-boolean-input"),_=(0,a.up)("sized-div"),d=(0,a.up)("form-text-field"),c=(0,a.up)("router-link"),u=(0,a.up)("form-text-input"),p=(0,a.up)("form-date-input");return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["documentattributerow",{documentattributerow_modified:s.is_highlighted}])},[s.is_selection_required?((0,a.wg)(),(0,a.j4)(_,{key:0,class:"documentattributerow__sizedblock_center",size:"w30"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{class:"documentattributerow__checkbox",value:s.is_selected,parameters:{size:20},onClick:t[0]||(t[0]=t=>e.$emit("select:doc"))},null,8,["value"])])),_:1})):(0,a.kq)("",!0),s.has_link?((0,a.wg)(),(0,a.j4)(_,{key:1,class:"documentattributerow__sizedblock_center",size:"w30"},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{class:"documentattributerow__href",to:s.link_route_obj},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{class:"documentattributerow__textfield",value:"@"})])),_:1},8,["to"])])),_:1})):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.search_schema,(t=>((0,a.wg)(),(0,a.j4)(_,{key:t.name,class:"documentattributerow__sizedblock",size:t.size,grow:t.grow},{default:(0,a.w5)((()=>[s.is_edit_mode&&!t.name.toLowerCase().includes("date")?((0,a.wg)(),(0,a.j4)(u,{key:0,class:"documentattributerow__textinput",value:s.attributes[t.name],parameters:{is_disabled:r.get_bool_attribute(t.is_disabled)||s.is_disabled,default:t.default},onUpdate:r=>e.$emit("update:doc",{id:s.id,name:t.name,value:r})},null,8,["value","parameters","onUpdate"])):(0,a.kq)("",!0),s.is_edit_mode&&t.name.toLowerCase().includes("date")?((0,a.wg)(),(0,a.j4)(p,{key:1,class:"documentattributerow__dateinput",value:s.attributes[t.name],parameters:{is_disabled:r.get_bool_attribute(t.is_disabled)||s.is_disabled,default:void 0===t.default||null===t.default?Math.round(Date.now()/1e3):t.default},onUpdate:r=>e.$emit("update:doc",{id:s.id,name:t.name,value:r})},null,8,["value","parameters","onUpdate"])):(0,a.kq)("",!0),s.is_edit_mode?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(d,{key:2,class:"documentattributerow__textfield",value:s.attributes[t.name],parameters:{align:t.align?t.align:"center",default:t.default}},null,8,["value","parameters"]))])),_:2},1032,["size","grow"])))),128))],2)}var pr={components:{SizedDiv:tr,FormTextField:Gt,FormTextInput:pe,FormDateInput:ds,FormBooleanInput:ts},name:"DocumentAttributeRow",props:{id:{type:[String,Number],required:!0},search_schema:{type:Array,required:!0},attributes:{type:Object,required:!0},is_selection_required:{type:Boolean,required:!1,default:!1},is_selected:{type:Boolean,required:!1,default:!1},is_edit_mode:{type:Boolean,required:!1,default:!1},is_highlighted:{type:Boolean,required:!1,default:!1},is_disabled:{type:Boolean,required:!1,default:!1},has_link:{type:Boolean,required:!1,default:!1},link_route_obj:{type:Object}},emits:["update:doc","select:doc"],setup(){const get_bool_attribute=e=>!0===e;return{get_bool_attribute:get_bool_attribute}}};const mr=(0,U.Z)(pr,[["render",DocumentAttributeRowvue_type_template_id_6127c01a_scoped_true_render],["__scopeId","data-v-6127c01a"]]);var gr=mr;const hr={class:"documentpagesortrow"};function DocumentPageSortRowvue_type_template_id_29807a96_scoped_true_render(e,t,s,r,n,i){const o=(0,a.up)("arrow-switch"),l=(0,a.up)("sized-div");return(0,a.wg)(),(0,a.iD)("div",hr,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.search_schema,(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.name,class:"documentpagesortrow__sizedblock",size:t.size,grow:t.grow},{default:(0,a.w5)((()=>[(0,a.Wm)(o,{class:"documentpagesortrow__arrow",is_checked:!0===s.sort_asc,is_selected:s.sort_by===t.name,onClick:a=>s.sort_by===t.name?e.$emit("toggle:direction"):e.$emit("sort:by",r.getSortNameAndFunction(t.name,t.sort_rule))},null,8,["is_checked","is_selected","onClick"])])),_:2},1032,["size","grow"])))),128))])}function ArrowSwitchvue_type_template_id_1e2cf47e_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["arrowswitch",{arrowswitch_selected:!0===s.is_selected,arrowswitch_checked:!0===s.is_checked}])},(0,i.zw)(s.is_checked?"▼":"▲"),3)}var fr={name:"ArrowSwitch",props:{is_selected:{type:Boolean,required:!0},is_checked:{type:Boolean,required:!0}}};const vr=(0,U.Z)(fr,[["render",ArrowSwitchvue_type_template_id_1e2cf47e_render]]);var wr=vr,yr={name:"DocumentPageSortRow",components:{SizedDiv:tr,ArrowSwitch:wr},props:{search_schema:{type:Object,required:!0},sort_asc:{type:Boolean,required:!0},sort_by:{type:String,required:!1}},emits:["toggle:direction","sort:by"],setup(){const getSortNameAndFunction=(e,t)=>[e,t];return{getSortNameAndFunction:getSortNameAndFunction}}};const br=(0,U.Z)(yr,[["render",DocumentPageSortRowvue_type_template_id_29807a96_scoped_true_render],["__scopeId","data-v-29807a96"]]);var kr=br;const Fr={class:"documentsearchstatusrow"};function DocumentSearchStatusRowvue_type_template_id_8c4e4b98_scoped_true_render(e,t,s,r,n,i){const o=(0,a.up)("form-text-field");return(0,a.wg)(),(0,a.iD)("div",Fr,[(0,a.Wm)(o,{value:r.status},null,8,["value"])])}var xr={components:{FormTextField:Gt},name:"DocumentSearchStatusRow",props:{time:{type:Number,required:!1},count:{type:Number,required:!0},min_index:{type:Number,required:!1},max_index:{type:Number,required:!1},count_of_selected:{type:Number,required:!1},is_searching:{type:Boolean,required:!1,default:!1}},setup(e){const t=(0,a.Fl)((()=>{if(e.is_searching)return"Поиск...";let t="Для поиска нажмите ENTER в любом окошке. Найдено "+e.count.toString()+"шт.";return e.time&&(t+=" ("+e.time.toString()+" сек.)"),void 0!==e.min_index&&void 0!==e.max_index&&(t+=" Показаны "+(e.min_index+1).toString()+"-"+(e.max_index+1).toString()+"."),void 0!==e.count_of_selected&&(t+=" Выделено "+e.count_of_selected.toString()+"шт."),t}));return{status:t}}};const Rr=(0,U.Z)(xr,[["render",DocumentSearchStatusRowvue_type_template_id_8c4e4b98_scoped_true_render],["__scopeId","data-v-8c4e4b98"]]);var qr=Rr;const Sr={class:"documentfilesrow"};function DocumentFilesRowvue_type_template_id_7c3004b6_scoped_true_render(e,t,s,r,n,i){const o=(0,a.up)("file-block");return(0,a.wg)(),(0,a.iD)("div",Sr,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.files,(t=>((0,a.wg)(),(0,a.iD)("div",{class:"documentfilesrow__fileblock",key:t.id},[(0,a.Wm)(o,{class:"documentfilesrow__file",file:t,can_be_deleted:s.can_be_deleted,can_be_dragged:s.can_be_dragged,"onDelete:file":s=>e.$emit("delete:file",t.id),"onDownload:file":s=>e.$emit("download:file",[t,s]),"onCopy_link_to:file":s=>e.$emit("copy_link_to:file",t)},null,8,["file","can_be_deleted","can_be_dragged","onDelete:file","onDownload:file","onCopy_link_to:file"])])))),128))])}var Dr={components:{FileBlock:Lt},name:"DocumentFilesRow",props:{files:{type:Array,required:!0},can_be_deleted:{type:Boolean,required:!1,default:!1},can_be_dragged:{type:Boolean,required:!1,default:!1}},emits:["delete:file","download:file","copy_link_to:file"]};const Er=(0,U.Z)(Dr,[["render",DocumentFilesRowvue_type_template_id_7c3004b6_scoped_true_render],["__scopeId","data-v-7c3004b6"]]);var Cr=Er,zr={components:{DocumentPageSearchRow:ur,DocumentAttributeRow:gr,DocumentPageSortRow:kr,DocumentPaginationRow:bt,DocumentSearchStatusRow:qr,DocumentFilesRow:Cr},name:"SearchComponent",props:{model_objects:{type:Array,required:!0},schema:{type:Object,required:!0},sort_by:{type:String,required:!0},sort_asc:{type:Boolean,required:!1,default:!1},sort_rule:{type:String,required:!1,default:"DEFAULT"},convert_obj_to_item:{type:Function,required:!0},current_id:{type:[Number,String],required:!1,default:0},search_time:{type:Number,required:!1,default:0},is_searching:{type:Boolean,required:!1,default:!1},should_emit_search_event_on_any_keypress:{type:Boolean,required:!1,default:!1},is_selection_required:{type:Boolean,required:!1,default:!1},has_link:{type:Boolean,required:!1,default:!1},is_files_shown:{type:Boolean,required:!1,default:!1}},emits:["choose","search","download:file","copy_link_to:file","select"],setup(e,{emit:t}){const s=(0,d.iH)(e.sort_by),r=(0,d.iH)(e.sort_asc),n=(0,d.iH)(e.sort_rule),i=(0,d.iH)(useGetSortFunction(n.value));(0,a.YP)(n,(e=>i.value=useGetSortFunction(e)));const o=(0,a.Fl)((()=>{let t=e.model_objects;return t.sort(((e,t)=>(!0===r.value?1:-1)*i.value(e[s.value],t[s.value]))),t.map((t=>e.convert_obj_to_item(t)))})),{pagination_variants:l,pagination_count_per_page:_,pagination_current_page:c,pagination_min_index:u,pagination_max_index:p,paginated_items:m,handle_set_page_range:g}=usePaginationMixin(o),{selected_item_ids:h,selected_items:f,count_of_selected_items:v,handle_select_all_items:w,handle_select_item:y,reset_selection:b}=useSelectionMixin(o,m);return(0,a.YP)(f,(e=>t("select",e))),{items:o,var_sort_by:s,var_sort_asc:r,var_sort_rule:n,paginated_items:m,handle_set_page_range:g,pagination_variants:l,pagination_count_per_page:_,pagination_current_page:c,pagination_min_index:u,pagination_max_index:p,selected_item_ids:h,selected_items:f,count_of_selected_items:v,handle_select_all_items:w,handle_select_item:y,reset_selection:b}}};const Nr=(0,U.Z)(zr,[["render",SearchComponentvue_type_template_id_1a8d1a54_scoped_true_render],["__scopeId","data-v-1a8d1a54"]]);var Ir=Nr,Lr={components:{HeadingComponent:le,BtnComponent:ne,BaseForm:Zs,SearchComponent:Ir},name:"ServersPage",setup(){const e=new VueUnitOfWork,t=e.user_repository.get_current(),convert_model_to_item=e=>({id:e.id,attributes:{id:e.id.toString(),name:e.name,host:e.host,port:e.port.toString(),location:e.location,zone:e.zone,latitude:e.latitude.toString(),longitude:e.longitude.toString(),is_on:!0===e.is_on?"Y":"N",is_active:!0===e.is_active?"Y":"N",created:convertDateToDateTimeString(e.created),updated:convertDateToDateTimeString(e.updated)},actions:{}}),s=(0,d.iH)({}),r=(0,a.Fl)((()=>filterArrayOfObjectsByQuery(e.cdn_server_repository.values().map((e=>e.value)),s.value))),n=(0,a.Fl)((()=>!!t.value&&t.value.permissions.includes("can_add_cdnserver"))),i=(0,a.Fl)((()=>!!t.value&&t.value.permissions.includes("can_change_cdnserver"))),o=(0,a.Fl)((()=>!!t.value&&t.value.permissions.includes("can_delete_cdnserver"))),l=(0,d.iH)(0),_=(0,d.iH)(!1),search_action=e=>s.value=e,c=[{name:"name",size:"w200",grow:!0,fields:[{placeholder:"Имя",rule:"icontains"}]},{name:"location",size:"w200",grow:!0,fields:[{placeholder:"Расположение",rule:"icontains"}]},{name:"zone",size:"w200",grow:!0,fields:[{placeholder:"Зона",rule:"icontains"}]},{name:"host",size:"w200",grow:!0,fields:[{placeholder:"Host",rule:"icontains"}]},{name:"port",size:"w100",fields:[{placeholder:"Port",rule:"icontains"}]},{name:"is_on",size:"w30",fields:[{type:"bool",placeholder:"Включен?",rule:"exact"}]},{name:"is_active",size:"w30",fields:[{type:"bool",placeholder:"Активен?",rule:"exact"}]}],u={id:null,name:"",host:"",port:"",location:"",zone:"",latitude:"",longitude:"",is_on:!1,is_active:!1,created:Date.now(),updated:Date.now()},p={port:e=>parseInt(e),latitude:e=>parseFloat(e),longitude:e=>parseFloat(e)},m={port:e=>e.toString(),latitude:e=>e.toString(),longitude:e=>e.toString()},{current_id:g,current:h,handle_update_attribute:f}=useCurrentMixin(u,e.cdn_server_repository,m),v=(0,a.Fl)((()=>h.value.name.length>0&&h.value.host.length>0&&parseInt(h.value.port)&&h.value.location.length>0&&h.value.zone.length>0&&parseFloat(h.value.latitude)&&parseFloat(h.value.longitude))),add_action=async()=>{const t=new AddCdnServer(...["name","host","port","location","zone","latitude","longitude","is_on","is_active"].map((e=>convertObject(h.value,p)[e])));await MessageBus.handle(t,e)},update_action=async()=>{const t=new UpdateCdnServer(...["id","name","host","port","location","zone","latitude","longitude","is_on","is_active"].map((e=>convertObject(h.value,p)[e])));await MessageBus.handle(t,e)},delete_action=async()=>{const t=new DeleteCdnServer(g.value);await MessageBus.handle(t,e),g.value=null},w=(0,a.Fl)((()=>[{size:"w450",fields:[{type:"FormTextField",value:"Имя:"},{type:"FormTextInput",bind:"name"},{type:"FormTextField",value:"Хост:"},{type:"FormTextInput",bind:"host"},{type:"FormTextField",value:"Порт:"},{type:"FormTextInput",bind:"port"},{type:"FormTextField",value:"Расположение:"},{type:"FormTextInput",bind:"location"},{type:"FormTextField",value:"Зона:"},{type:"FormTextInput",bind:"zone"},{type:"FormTextField",value:"Широта:"},{type:"FormTextInput",bind:"latitude"},{type:"FormTextField",value:"Долгота:"},{type:"FormTextInput",bind:"longitude"},{type:"FormTextField",value:"Включен ?"},{type:"FormBooleanInput",bind:"is_on"},{type:"FormTextField",value:"Активен ?"},{type:"FormBooleanInput",bind:"is_active"}]}])),refresh_tokens=async()=>await MessageBus.handle(new RefreshTokens,e);return e.token_timer.set_callback(refresh_tokens),e.token_timer.start(),(0,a.bv)((async()=>{await useBeforeEnterPage(e,[]),await MessageBus.handle(new GetCdnServers,e)})),{search_action:search_action,add_action:add_action,update_action:update_action,delete_action:delete_action,can_add:n,can_change:i,can_delete:o,current_id:g,current:h,is_edit_block_valid:v,handle_update_attribute:f,form_pages:w,search_schema:c,model_objects:r,convert_model_to_item:convert_model_to_item,search_time:l,is_searching:_}}};const Ar=(0,U.Z)(Lr,[["render",ServersPagevue_type_template_id_0b134db0_scoped_true_render],["__scopeId","data-v-0b134db0"]]);var Br=Ar;const jr={class:"message"},Tr={class:"message__text"};function MessagePagevue_type_template_id_78023fef_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",jr,[(0,a._)("div",Tr,(0,i.zw)(s.text),1)])}var Or={name:"MessagePage",props:{text:{type:String,required:!0}}};const Ur=(0,U.Z)(Or,[["render",MessagePagevue_type_template_id_78023fef_render]]);var Pr=Ur;const Zr={class:"page"},Wr={key:0,class:"page__form-backdrop"};function DownloadFilePagevue_type_template_id_c9fe0e18_scoped_true_render(e,t,s,r,n,i){const o=(0,a.up)("document-page-download-progress-row"),l=(0,a.up)("base-form");return(0,a.wg)(),(0,a.iD)("div",Zr,[(0,a.Wm)(o,{class:"page__downloadprogress",files:r.downloading_files,full_format:!0},null,8,["files"]),r.is_form_opened?((0,a.wg)(),(0,a.iD)("div",Wr,[(0,a.Wm)(l,{class:"page__form",attributes:r.form_attributes,settings:r.form_pages,onUpdate:t[0]||(t[0]=e=>r.handle_update_form_attribute(e.name,e.value)),onClose:t[1]||(t[1]=e=>r.handle_form_close()),onApply:t[2]||(t[2]=e=>r.handle_form_apply())},null,8,["attributes","settings"])])):(0,a.kq)("",!0)])}const Hr={class:"documentpagedownloadprogressrow"},Mr={key:0,class:"documentpagedownloadprogressrow__item"},Gr={key:1,class:"documentpagedownloadprogressrow__item"};function DocumentPageDownloadProgressRowvue_type_template_id_30857a85_scoped_true_render(e,t,s,r,n,o){return(0,a.wg)(),(0,a.iD)("div",Hr,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.files,(e=>((0,a.wg)(),(0,a.iD)("div",{class:"documentpagedownloadprogressrow__container",key:e.id},[s.full_format?((0,a.wg)(),(0,a.iD)("span",Mr,'Происходит скачивание файла "'+(0,i.zw)(e.name)+'" объемом '+(0,i.zw)(e.formatted_size())+" - "+(0,i.zw)(e.progress)+"%",1)):(0,a.kq)("",!0),!s.full_format&&e.progress<100?((0,a.wg)(),(0,a.iD)("span",Gr,"("+(0,i.zw)(e.formatted_size())+" - "+(0,i.zw)(e.progress)+"%)",1)):(0,a.kq)("",!0)])))),128))])}var $r={name:"DocumentPageDownloadProgressRow",props:{files:{type:Array,required:!0},full_format:{type:Boolean,default:!1}}};const Kr=(0,U.Z)($r,[["render",DocumentPageDownloadProgressRowvue_type_template_id_30857a85_scoped_true_render],["__scopeId","data-v-30857a85"]]);var Yr=Kr,Jr={components:{DocumentPageDownloadProgressRow:Yr,BaseForm:Zs},name:"DownloadFilePage",setup(){const e=new VueUnitOfWork,t=(0,Y.yj)(),s=t.params.file_id,r=t.params.link_id,n=(0,a.Fl)((()=>e.download_progress.values().map((e=>e.value)))),download_file=async()=>{const t=await MessageBus.handle(new GetFileShareLink(s,r),e),a=t[0];console.log(a),a&&(a.is_secured?i.value=!0:await MessageBus.handle(new DownloadFileByFileShareLink(s,r,null),e))},i=(0,d.iH)(!1),o=(0,d.qj)({PASSWORD:""}),handle_form_close=()=>{i.value=!1},handle_form_apply=async()=>{const t=o["PASSWORD"];t?(i.value=!1,await MessageBus.handle(new DownloadFileByFileShareLink(s,r,t),e)):await MessageBus.handle(new Notify("error","Введите пароль"),e)},handle_update_form_attribute=(e,t)=>o[e]=t,l=[{size:400,name:"Защищенная ссылка",fields:[{type:"FormTextField",parameters:{font_weight:"bold"},value:"Введите пароль:"},{type:"FormTextInput",bind:"PASSWORD"}]}];return(0,a.bv)((async()=>{await download_file()})),{downloading_files:n,is_form_opened:i,form_pages:l,form_attributes:o,handle_update_form_attribute:handle_update_form_attribute,handle_form_apply:handle_form_apply,handle_form_close:handle_form_close}}};const Vr=(0,U.Z)(Jr,[["render",DownloadFilePagevue_type_template_id_c9fe0e18_scoped_true_render],["__scopeId","data-v-c9fe0e18"]]);var Xr=Vr;const Qr=[{path:"/files/:file_id/links/:link_id",name:"DownloadFilePage",component:Xr},{path:"/login",name:"LoginPage",component:he},{path:"/",name:"MainPage",component:Ms},{path:"/servers",name:"ServersPage",component:Br},{path:"/:pathMatch(.*)*",name:"PageNotFound",component:Pr,props:{text:"Страница не найдена"}}],ea=(0,Y.p7)({history:(0,Y.PO)("/"),routes:Qr});var ta=ea;(0,r.ri)(K).use(ta).mount(".app")},5832:function(){},2361:function(){},4616:function(){}},t={};function __webpack_require__(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,__webpack_require__),a.exports}__webpack_require__.m=e,function(){var e=[];__webpack_require__.O=function(t,s,r,a){if(!s){var n=1/0;for(_=0;_<e.length;_++){s=e[_][0],r=e[_][1],a=e[_][2];for(var i=!0,o=0;o<s.length;o++)(!1&a||n>=a)&&Object.keys(__webpack_require__.O).every((function(e){return __webpack_require__.O[e](s[o])}))?s.splice(o--,1):(i=!1,a<n&&(n=a));if(i){e.splice(_--,1);var l=r();void 0!==l&&(t=l)}}return t}a=a||0;for(var _=e.length;_>0&&e[_-1][2]>a;_--)e[_]=e[_-1];e[_]=[s,r,a]}}(),function(){__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return __webpack_require__.d(t,{a:t}),t}}(),function(){__webpack_require__.d=function(e,t){for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};__webpack_require__.O.j=function(t){return 0===e[t]};var webpackJsonpCallback=function(t,s){var r,a,n=s[0],i=s[1],o=s[2],l=0;if(n.some((function(t){return 0!==e[t]}))){for(r in i)__webpack_require__.o(i,r)&&(__webpack_require__.m[r]=i[r]);if(o)var _=o(__webpack_require__)}for(t&&t(s);l<n.length;l++)a=n[l],__webpack_require__.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return __webpack_require__.O(_)},t=self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[];t.forEach(webpackJsonpCallback.bind(null,0)),t.push=webpackJsonpCallback.bind(null,t.push.bind(t))}();var s=__webpack_require__.O(void 0,[998],(function(){return __webpack_require__(4166)}));s=__webpack_require__.O(s)})();
//# sourceMappingURL=app.90842a6e.js.map